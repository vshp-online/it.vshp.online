-- ===========================
-- 1. Тестирование хранимой процедуры assign_employee_to_project
-- ===========================

-- Пример успешного вызова: добавление сотрудника в проект
CALL assign_employee_to_project(1, 2, 'аналитик', 50);

-- Пример вызова с ошибкой: сотрудник не найден
CALL assign_employee_to_project(999, 1, 'аналитик', 50);
-- Ожидаемый результат: ошибка "Сотрудник или проект не найдены"

-- Пример вызова с ошибкой: проект не найден
CALL assign_employee_to_project(1, 999, 'аналитик', 50);
-- Ожидаемый результат: ошибка "Сотрудник или проект не найдены"

-- Пример вызова с варнингом: сотрудник уже участвует в проекте
CALL assign_employee_to_project(1, 1, 'аналитик', 50);
-- Ожидаемый результат: варнинг "Сотрудник уже участвует в проекте"

-- Проверка результата
SELECT * FROM employee_projects WHERE employee_id = 1 AND project_id = 2;

-- ===========================
-- 2. Тестирование пользовательской функции get_project_count_for_employee
-- ===========================

-- Пример вызова: подсчёт проектов для сотрудника
SELECT get_project_count_for_employee(1) AS project_count;

-- Пример вызова: сотрудник не найден
SELECT get_project_count_for_employee(999) AS project_count;
-- Ожидаемый результат: возвращается 0

-- ===========================
-- 3. Тестирование триггера log_project_update
-- ===========================

-- Пример вызова: обновление данных о проекте
UPDATE projects
SET project_name = 'Новая CRM-система'
WHERE id = 1;

-- Проверка результата: логи изменений
SELECT * FROM change_logs;

-- ===========================
-- 4. Тестирование представления employee_project_summary
-- ===========================

-- Пример вызова: получение данных из представления
SELECT * FROM employee_project_summary;

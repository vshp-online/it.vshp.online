-- ===========================
-- 1. Тестирование хранимой процедуры sell_book
-- ===========================

-- Пример успешного вызова: продажа книги
CALL sell_book(1, 5);

-- Пример вызова с ошибкой: книга не найдена
CALL sell_book(999, 5);
-- Ожидаемый результат: ошибка "Книга не найдена"

-- Пример вызова с варнингом: недостаточно книг на складе
CALL sell_book(1, 50);
-- Ожидаемый результат: варнинг "Недостаточно книг на складе"

-- Проверка результата
SELECT * FROM sales WHERE book_id = 1;

-- ===========================
-- 2. Тестирование пользовательской функции get_books_by_supplier
-- ===========================

-- Пример вызова: подсчёт книг для поставщика
SELECT get_books_by_supplier(1) AS books_count;

-- Пример вызова: поставщик не найден
SELECT get_books_by_supplier(999) AS books_count;
-- Ожидаемый результат: возвращается 0

-- ===========================
-- 3. Тестирование триггера log_stock_update
-- ===========================

-- Пример вызова: уменьшение количества книг на складе
UPDATE books
SET stock = stock - 2
WHERE id = 1;

-- Проверка результата: логи изменений
SELECT * FROM change_logs;

-- ===========================
-- 4. Тестирование представления supplier_sales_summary
-- ===========================

-- Пример вызова: получение данных из представления
SELECT * FROM supplier_sales_summary;

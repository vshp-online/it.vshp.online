-- ===========================
-- 1. Тестирование хранимой процедуры sell_car
-- ===========================

-- Пример успешного вызова: продажа автомобиля
CALL sell_car(1, 1, 1);

-- Пример вызова с ошибкой: клиент не найден
CALL sell_car(999, 1, 1);
-- Ожидаемый результат: ошибка "Клиент, автомобиль или менеджер не найдены"

-- Пример вызова с ошибкой: автомобиль уже продан
CALL sell_car(1, 1, 1);
-- Ожидаемый результат: ошибка "Автомобиль уже продан"

-- Проверка результата
SELECT * FROM orders WHERE client_id = 1 AND car_id = 1;

-- ===========================
-- 2. Тестирование пользовательской функции calculate_commission
-- ===========================

-- Пример вызова: вычисление комиссии менеджера
SELECT calculate_commission(1) AS commission;

-- Пример вызова: заказ не найден
SELECT calculate_commission(999) AS commission;
-- Ожидаемый результат: возвращается 0

-- ===========================
-- 3. Тестирование триггера log_car_status_update
-- ===========================

-- Пример вызова: изменение статуса автомобиля
UPDATE cars
SET status = 'sold'
WHERE id = 1;

-- Проверка результата: логи изменений
SELECT * FROM change_logs;

-- ===========================
-- 4. Тестирование представления manager_sales_summary
-- ===========================

-- Пример вызова: получение данных из представления
SELECT * FROM manager_sales_summary;

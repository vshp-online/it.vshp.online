<!-- @include: ./includes/_disclaimer.md -->

# ОП.08 - Практический экзамен - Вариант №5

## База данных автосалона

Необходимо разработать типовую БД, в которой должны быть отражены следующие сущности:

- Сущность «Клиент»
  - Атрибут «Имя клиента»
- Сущность «Менеджер»
  - Атрибут «Имя менеджера»
  - Атрибут «Фамилия менеджера»
- Сущность «Продажа»
  - Атрибут «Тип оплаты»
  - Атрибут «Дата продажи»
  - Атрибут «Сумма сделки»
- Сущность «Автомобиль»
  - Атрибут «Марка»
  - Атрибут «Модель»
  - Атрибут «Пробег»
  - Атрибут «Модификация»

При этом, учесть, что:

- У менеджера может быть несколько клиентов
- У клиента может быть только один менеджер
- У клиента может быть несколько покупок
- Продажа производится только одному клиенту одним менеджером
- В рамках одной продажи может участвовать только один автомобиль

Необходимо четко указывать названия таблиц и полей, в которые будет занесена информация.

Необходимо импортировать в созданную БД данные:

::: details exam_var_5_data.sql

@[code sql:collapsed-lines=5](./includes/exam_var_5_data.sql)

:::

## Задачи

Необходимо разнести данные из временной таблицы `tmp` в каждую из вновь созданных в соответствии со структурой таблиц БД, при этом сохранив все связи, после чего таблицу `tmp` необходимо удалить из БД.

Необходимо написать соответствующие SQL-запросы для выполнения следующих действий с базой данных:

1. Вывести всех клиентов, купивших больше одного автомобиля
2. Вывести всех менеджеров, у которых больше 10 клиентов
3. Вывести всех менеджеров, у которых меньше 30 продаж
4. Вывести все продажи, произведенные по безналичной оплате
5. Вывести 5 последних купленных автомобилей для любого клиента
6. Посчитать сколько в среднем денег приносят продажи с использованием наличной и безналичной оплаты
7. Посчитать сумму всех сделок для менеджера с наибольшим количеством сделок

::: tip

Рекомендуемый порядок разбора данных:

1. __Клиент__ (первичный ключ `id` генерируемый)
2. __Менеджер__ (первичный ключ `id` генерируемый)
3. __Автомобиль__ (можно использовать `id` из `tmp` как первичный ключ)
4. __Продажа__ (первичный ключ `id` генерируемый, учесть что не каждый автомобиль может быть продан)

:::

## Результат

Задание должно быть выполнено в локальной файловой системе компьютера. Папка со всеми файлами задания должна называться:

__`ОП.08 - Вариант 5 - Иванов И.И.`__

где вместо `Иванов И.И.` должны быть указаны фамилия и инициалы сдающего.

Результат выполнения задания должен быть оформлен в виде файлов:

1. Файл дампа итоговой БД в формате SQL, должен называться: `db_5.sql`
2. Файл последовательных SQL-запросов для каждого из пунктов задания, должен называться: `task_5.sql`, каждый запрос должен отделяться комментарием с номером соответствующего пункта задания
3. Файл, отражающий ERD-диаграмму созданной БД со всеми связями, должен называться `erd_5.png`

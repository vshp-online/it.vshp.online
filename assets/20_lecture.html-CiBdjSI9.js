import{_ as r,c as k,b as n,d as p,a as m,w as e,r as u,o as y,e as s}from"./app-DiDl7sIA.js";const E={};function b(v,a){const d=u("Mermaid"),i=u("Tabs");return y(),k("div",null,[a[8]||(a[8]=n("h1",{id:"мдк-11-01-20-пользовательские-функции",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#мдк-11-01-20-пользовательские-функции"},[n("span",null,"МДК.11.01 - 20 - Пользовательские функции")])],-1)),a[9]||(a[9]=n("p",null,"Примеры данной темы используют учебную БД:",-1)),p(i,{data:[{id:"Структура БД"},{id:"Дамп"},{id:"Таблицы"}]},{title0:e(({value:t,isActive:l})=>[...a[0]||(a[0]=[s("Структура БД",-1)])]),title1:e(({value:t,isActive:l})=>[...a[1]||(a[1]=[s("Дамп",-1)])]),title2:e(({value:t,isActive:l})=>[...a[2]||(a[2]=[s("Таблицы",-1)])]),tab0:e(({value:t,isActive:l})=>[p(d,{code:"eJxLLXLJTEwvSszlUlAoLU4tKlaoBrIUFDz9QhQyUxQCvMG8MMcgZw/HIIW8xNxUoEAtECcmJ+eX5pXgV1+SWZID0gCRB5kfD1TkBlHk4urs6evoo5CUmJOYlwwzF+KImhpd3fxqhCVWCkoX9l3YcmHHhb26F3Zd2Kd7Yc+FvUCRzUCRPUpcAN0zQl0="})]),tab1:e(({value:t,isActive:l})=>[...a[3]||(a[3]=[n("div",{class:"language-sql line-numbers-mode has-collapsed-lines collapsed","data-highlighter":"prismjs","data-ext":"sql",style:{"--vp-collapsed-lines":"10"}},[n("pre",null,[n("code",{class:"language-sql"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"SET"),s(" foreign_key_checks "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"DROP"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token keyword"},"EXISTS"),s(" users"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"DROP"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token keyword"},"EXISTS"),s(" accounts"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("users"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"AUTO_INCREMENT"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("name"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"VARCHAR"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"255"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"PRIMARY"),s(),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"LOCK"),s(),n("span",{class:"token keyword"},"TABLES"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("users"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"WRITE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"INSERT"),s(),n("span",{class:"token keyword"},"INTO"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("users"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"VALUES"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Иванов Иван Иванович'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Петров Петр Петрович'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Сидоров Сидор Сидорович'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"UNLOCK"),s(),n("span",{class:"token keyword"},"TABLES"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("accounts"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"AUTO_INCREMENT"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("title"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"VARCHAR"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"255"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"DEFAULT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("balance"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"DECIMAL"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"DEFAULT"),s(),n("span",{class:"token string"},"'0.00'"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"PRIMARY"),s(),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id_idx"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"CONSTRAINT"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"FOREIGN"),s(),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"REFERENCES"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("users"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"ON"),s(),n("span",{class:"token keyword"},"DELETE"),s(),n("span",{class:"token keyword"},"CASCADE")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"ON"),s(),n("span",{class:"token keyword"},"UPDATE"),s(),n("span",{class:"token keyword"},"CASCADE")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"LOCK"),s(),n("span",{class:"token keyword"},"TABLES"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("accounts"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"WRITE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"INSERT"),s(),n("span",{class:"token keyword"},"INTO"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("accounts"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"VALUES"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Основной'"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"10500.00"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Резервный'"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"3412.57"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Основной'"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"20750.00"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"4"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Основной'"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"25000.00"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Накопительный'"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"5401.75"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"UNLOCK"),s(),n("span",{class:"token keyword"},"TABLES"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"SET"),s(" foreign_key_checks "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})]),n("div",{class:"collapsed-lines"})],-1)])]),tab2:e(({value:t,isActive:l})=>[p(i,{data:[{id:"<strong>users</strong>"},{id:"<strong>accounts</strong>"}]},{title0:e(({value:o,isActive:c})=>[...a[4]||(a[4]=[n("strong",null,"users",-1)])]),title1:e(({value:o,isActive:c})=>[...a[5]||(a[5]=[n("strong",null,"accounts",-1)])]),tab0:e(({value:o,isActive:c})=>[...a[6]||(a[6]=[n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"right"}},"id"),n("th",{style:{"text-align":"left"}},"name")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"left"}},"Иванов Иван Иванович")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"left"}},"Петров Петр Петрович")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"3"),n("td",{style:{"text-align":"left"}},"Сидоров Сидор Сидорович")])])],-1)])]),tab1:e(({value:o,isActive:c})=>[...a[7]||(a[7]=[n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"right"}},"id"),n("th",{style:{"text-align":"left"}},"title"),n("th",{style:{"text-align":"right"}},"user_id"),n("th",{style:{"text-align":"right"}},"balance")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"left"}},"Основной"),n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"right"}},"10500")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"left"}},"Резервный"),n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"right"}},"3412.57")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"3"),n("td",{style:{"text-align":"left"}},"Основной"),n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"right"}},"20750")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"4"),n("td",{style:{"text-align":"left"}},"Основной"),n("td",{style:{"text-align":"right"}},"3"),n("td",{style:{"text-align":"right"}},"25000")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"5"),n("td",{style:{"text-align":"left"}},"Накопительный"),n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"right"}},"5401.75")])])],-1)])]),_:2},1024)]),_:1}),a[10]||(a[10]=m(`<p>MySQL 8 предлагает широкий набор функций, которые позволяют выполнять различные операции над данными в базе данных. Функции могут быть использованы для выполнения вычислений, преобразования данных, агрегации и других задач.</p><div class="hint-container info"><p class="hint-container-title">Инфо</p><p>В MySQL существуют как встроенные функции (со многими из которых вы уже знакомы, например с агрегирующими <code>SUM()</code> или <code>COUNT()</code>), так и пользовательские (которые может создать пользователь для конкретной БД). Здесь и далее, говоря про пользовательские функции в MySQL обычно говорят просто &quot;функции&quot;, уточняя в том случае где в контексте нужно отличить их от встроенных.</p></div><p>Вот пример функции для MySQL 8, которая рассчитывает налог НДС на основе переданной суммы:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">DELIMITER</span> $$</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> calculate_vat<span class="token punctuation">(</span>amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">RETURNS</span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">DECLARE</span> vat <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">SET</span> vat <span class="token operator">=</span> amount <span class="token operator">*</span> <span class="token number">0.2</span><span class="token punctuation">;</span> <span class="token comment">-- 20% ставка НДС</span></span>
<span class="line">    <span class="token keyword">RETURN</span> vat<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> $$</span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">Примечание</p><p>Если в процессе выполнения запроса возникла ошибка <code>Error Code: 1418. This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled</code>, это связано с тем, что в вашей функции отсутствует одно из трех ключевых слов: <code>DETERMINISTIC</code>, <code>NO SQL</code> или <code>READS SQL DATA</code>, которые определяют тип функции. В MySQL 8, если бинарное журналирование включено, функции должны быть помечены одним из этих ключевых слов для обеспечения безопасности и целостности данных. Для учебных целей, вы можете попробовать изменить значение переменной <code>@@log_bin_trust_function_creators</code> на <code>1</code> при помощи запроса: <code>SET GLOBAL log_bin_trust_function_creators = 1;</code>, а получить текущее значение можно при помощи запроса: <code>SELECT @@log_bin_trust_function_creators;</code>. Это позволит создавать функции без указания ключевых слов <code>DETERMINISTIC</code>, <code>NO SQL</code> или <code>READS SQL DATA</code>. Однако, в реальных проектах так не делают, так как это может повлиять на безопасность и целостность данных.</p></div><p>В этом примере мы создаем функцию с именем <code>calculate_vat</code>, которая принимает параметр <code>amount</code> типа <code>DECIMAL(10,2)</code> (сумма) и возвращает значение типа <code>DECIMAL(10,2)</code> (налог НДС). Внутри функции мы объявляем переменную <code>vat</code> типа <code>DECIMAL(10,2)</code>, затем рассчитываем налог НДС, умножая сумму на <code>0.2</code> (что соответствует 20% ставке НДС). Наконец, мы возвращаем значение переменной <code>vat</code> с помощью оператора <code>RETURN</code>.</p><p>Теперь мы можем использовать эту функцию для расчета налога НДС на основе переданной суммы. Например:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> calculate_vat<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Этот запрос вернет налог НДС для суммы <code>100</code>. В данном случае, функция вернет значение <code>20</code>, так как 20% от <code>100</code> равно <code>20</code>.</p><h3 id="пометка-типа-функции-в-mysql-8" tabindex="-1"><a class="header-anchor" href="#пометка-типа-функции-в-mysql-8"><span>Пометка типа функции в MySQL 8</span></a></h3><p>Ключевые слова <code>DETERMINISTIC</code>, <code>NO SQL</code> и <code>READS SQL DATA</code> используются для пометки функций в MySQL и указания их свойств и поведения. Они были введены в MySQL 5.0 для обеспечения безопасности и целостности данных.</p><ol><li><p><code>DETERMINISTIC</code>:</p><ul><li>Ключевое слово <code>DETERMINISTIC</code> указывает, что функция всегда возвращает одинаковый результат для одних и тех же входных данных.</li><li>Это означает, что функция не зависит от внешних факторов, таких как текущее время или состояние базы данных.</li><li>Если функция помечена как <code>DETERMINISTIC</code>, MySQL может кэшировать результаты вызова функции и использовать их для оптимизации запросов.</li><li>Это ключевое слово особенно полезно для функций, которые используются в выражениях <code>SELECT</code>, чтобы гарантировать, что результаты будут предсказуемыми и однозначными.</li></ul></li><li><p><code>NO SQL</code>:</p><ul><li>Ключевое слово <code>NO SQL</code> указывает, что функция не выполняет операции с базой данных.</li><li>Это означает, что функция не изменяет данные в базе данных и не делает запросы к другим таблицам или представлениям.</li><li>Если функция помечена как <code>NO SQL</code>, MySQL может оптимизировать ее выполнение, так как нет необходимости проверять изменения данных или блокировать таблицы.</li></ul></li><li><p><code>READS SQL DATA</code>:</p><ul><li>Ключевое слово <code>READS SQL DATA</code> указывает, что функция может выполнять операции чтения данных из базы данных.</li><li>Это означает, что функция может использовать операторы <code>SELECT</code> для получения данных из таблиц или представлений.</li><li>Если функция помечена как <code>READS SQL DATA</code>, MySQL может оптимизировать ее выполнение, учитывая кэширование данных и другие оптимизации чтения.</li></ul></li></ol><p>Важно отметить, что эти ключевые слова не обязательны для всех функций в MySQL. Они рекомендуются для использования только в тех случаях, когда они действительно применимы. Неправильное использование этих ключевых слов может привести к непредсказуемому поведению функций или проблемам с производительностью.</p><p>Например, если у вас есть функция, которая всегда возвращает текущее время, вы можете пометить ее как <code>DETERMINISTIC</code>, так как результат будет одинаковым для каждого вызова с одними и теми же входными данными. Если у вас есть функция, которая только читает данные из таблицы, вы можете пометить ее как <code>READS SQL DATA</code>, чтобы MySQL мог оптимизировать ее выполнение.</p><p>В целом, ключевые слова <code>DETERMINISTIC</code>, <code>NO SQL</code> и <code>READS SQL DATA</code> помогают оптимизировать выполнение функций и обеспечивают безопасность и целостность данных в MySQL.</p><p>В случае нашей функции, можно будет пометить её как <code>DETERMINISTIC</code>(т.к. при одних и тех же входных данных она будет давать одинаковый результат):</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">DELIMITER</span> $$</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> calculate_vat<span class="token punctuation">(</span>amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">RETURNS</span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">DETERMINISTIC</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">DECLARE</span> vat <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">SET</span> vat <span class="token operator">=</span> amount <span class="token operator">*</span> <span class="token number">0.2</span><span class="token punctuation">;</span> <span class="token comment">-- 20% ставка НДС</span></span>
<span class="line">    <span class="token keyword">RETURN</span> vat<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> $$</span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Теперь создать такую функцию можно без изменения значения глобальной переменной <code>log_bin_trust_function_creators</code>.</p><h2 id="различия-функции-и-хранимых-процедур" tabindex="-1"><a class="header-anchor" href="#различия-функции-и-хранимых-процедур"><span>Различия функций и хранимых процедур</span></a></h2><p>MySQL 8 позволяет создавать и использовать как хранимые процедуры так и пользовательские функции для выполнения различных операций. При этом, функции и хранимые процедуры являются двумя различными типами объектов базы данных, каждый из которых имеет свои особенности и применение.</p><p><strong>Хранимые процедуры:</strong></p><ul><li>Хранимые процедуры в MySQL 8 представляют собой набор инструкций, которые выполняются последовательно при вызове процедуры.</li><li>Хранимые процедуры могут содержать операторы SQL, условные выражения, циклы и другие конструкции языка программирования.</li><li>Хранимые процедуры могут использоваться для выполнения сложных операций, включая манипуляции с данными, обработку ошибок и транзакции.</li><li>Хранимые процедуры могут вызываться из других хранимых процедур, функций, триггеров и приложений.</li><li>Пример использования хранимой процедуры: <code>CALL calculate_discount(price, discount, @discounted_price); SELECT @discounted_price;</code></li></ul><p><strong>Пользовательские функции:</strong></p><ul><li>Функции в MySQL 8 предназначены для возврата значения на основе заданных входных параметров.</li><li>Функции могут использоваться в выражениях SELECT, WHERE, HAVING и других частях запроса для вычисления значений.</li><li>Функции могут быть вызваны из других функций, хранимых процедур и триггеров.</li><li>Функции могут содержать только операторы SQL и не могут изменять данные в базе данных.</li><li>Пример использования функции: <code>SELECT calculate_total(price, quantity) FROM products;</code></li></ul><p>Теперь рассмотрим, для чего лучше использовать функции и хранимые процедуры:</p><ul><li>Используйте хранимые процедуры, когда вам нужно выполнить сложные операции, включая манипуляции с данными, обработку ошибок и транзакции, в том числе для группирования логически связанных инструкций в одном месте и обеспечивают повторное использование кода.</li><li>Используйте функции, когда вам нужно вычислить и вернуть значение на основе входных параметров,в различных частях БД, в том числе в выражениях <code>SELECT</code>, <code>WHERE</code>, <code>HAVING</code> и других частях запроса для вычисления значений.</li></ul><p>В целом, функции и хранимые процедуры в MySQL 8 имеют разные цели и применение. Функции используются для вычисления и возврата значений, а хранимые процедуры — для выполнения сложных операций. Выбор между ними зависит от конкретных требований вашего проекта.</p><hr><h2 id="задание-для-самопроверки" tabindex="-1"><a class="header-anchor" href="#задание-для-самопроверки"><span>Задание для самопроверки</span></a></h2><ol><li><p>Модифицируйте БД таким образом чтобы в ней можно было хранить совершенные транзакции (например, в таблице <code>transactions</code>), с указанием типа транзакции для пополнения (<code>deposit</code>), снятия (<code>withdrawal</code>) и перевода денежных средств между счетами (<code>transfer</code>). При этом необходимо учитывать дату и время, сумму транзакции, тип транзакции а также <code>id</code> пользователя и счет с которого он её совершил, а для операции перевода между счетами не забудьте указать счет на который совершается перевод.</p></li><li><p>Реализуйте хранимую процедуру <code>moveMoney</code>, которая позволит выполнить любой из типов транзакции (<code>deposit</code>,<code>withdrawal</code>,<code>transfer</code>), не забудьте проверить каждый тип транзакции на возможность выполнения (положить можно любую сумму, а вот снять и перевести можно не больше чем на счете есть денег).</p></li><li><p>Добавьте в таблицу <code>transactions</code> сумму комиссии за совершение операции. Для каждого из типов операций будет своя комиссия, а именно:</p><ul><li>за пополнение счета комиссия не предусмотрена</li><li>за снятие предусмотрена комиссия в размере <code>3%</code> от суммы операции</li><li>за перевод между счетами предусмотрена комиссия в размере <code>0.5%</code> от суммы операции (уплачивает тот кто переводит)</li></ul><p>Учтите, что хранить в транзакциях необходимо отдельно сумму перевода, сумму комиссии а также полную сумму транзакции. Расчет комиссии реализуйте при помощи пользовательской функции <code>calculateFee</code>, которая принимает два аргумента: тип транзакции и сумму для расчета, а возвращает сумму комиссии (за пополнение счета должна вернуть <code>0</code>)</p></li></ol>`,30))])}const T=r(E,[["render",b]]),L=JSON.parse('{"path":"/disciplines/mdk1101/lectures/20_lecture.html","title":"МДК.11.01 - 20 - Пользовательские функции","lang":"ru-RU","frontmatter":{"description":"МДК.11.01 - 20 - Пользовательские функции Примеры данной темы используют учебную БД: MySQL 8 предлагает широкий набор функций, которые позволяют выполнять различные операции над...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"МДК.11.01 - 20 - Пользовательские функции\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-24T14:30:06.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://it.vshp.online/disciplines/mdk1101/lectures/20_lecture.html"}],["meta",{"property":"og:site_name","content":"Кафедра ИТ"}],["meta",{"property":"og:title","content":"МДК.11.01 - 20 - Пользовательские функции"}],["meta",{"property":"og:description","content":"МДК.11.01 - 20 - Пользовательские функции Примеры данной темы используют учебную БД: MySQL 8 предлагает широкий набор функций, которые позволяют выполнять различные операции над..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ru-RU"}],["meta",{"property":"og:updated_time","content":"2025-10-24T14:30:06.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-24T14:30:06.000Z"}]]},"git":{"updatedTime":1761316206000,"contributors":[{"name":"PAVEL TKACHEV","username":"","email":"phoenixweiss@ya.ru","commits":1}],"changelog":[{"hash":"7164abf5ea181652ae6e18935015af58c1253ed4","time":1761316206000,"email":"phoenixweiss@ya.ru","author":"PAVEL TKACHEV","message":"Update 14_lecture.md, 15_lecture.md, 16_lecture.md, and 16 more files"}]},"autoDesc":true,"filePathRelative":"disciplines/mdk1101/lectures/20_lecture.md"}');export{T as comp,L as data};

import{_ as r,c as d,b as n,d as c,a as y,w as t,r as u,o as m,e as s}from"./app-CRAEKUA-.js";const v={};function b(E,a){const k=u("Mermaid"),i=u("Tabs");return m(),d("div",null,[a[10]||(a[10]=n("h1",{id:"мдк-11-01-21-триггеры",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#мдк-11-01-21-триггеры"},[n("span",null,"МДК.11.01 - 21 - Триггеры")])],-1)),a[11]||(a[11]=n("p",null,"Примеры данной темы используют учебную БД:",-1)),c(i,{data:[{id:"Структура БД"},{id:"Дамп"},{id:"Таблицы"}]},{title0:t(({value:e,isActive:p})=>[...a[0]||(a[0]=[s("Структура БД",-1)])]),title1:t(({value:e,isActive:p})=>[...a[1]||(a[1]=[s("Дамп",-1)])]),title2:t(({value:e,isActive:p})=>[...a[2]||(a[2]=[s("Таблицы",-1)])]),tab0:t(({value:e,isActive:p})=>[c(k,{code:"eJydUMsKglAQ3fcVQ3t/oJ2kkZQRYW1lMosLeQ2dFqF9VS0i1G+4n9T1XdIDWlyYe+acM2fGDTSGuwC9HsAxdIMQIlkBGDML2Abmk+K3UhfDsboAjp7btHGX12f50HH8I6fvWmK0b8X5LFuSRiVJ04eGqU5hjXvkTu1LAfIQHWI+f++tqZZuGaYOGyTXJlalq93Qy2MVkD5bms9+Np0OH9MU25U7ddDCYSvJ5Nsto4pb3i+OFcWP2psMoC8ycRU3kSriLjJFJCKVyEUiSb8re1n5p7QZ8of6ATwbtjU="})]),tab1:t(({value:e,isActive:p})=>[...a[3]||(a[3]=[n("div",{class:"language-sql line-numbers-mode has-collapsed-lines collapsed","data-highlighter":"prismjs","data-ext":"sql",style:{"--vp-collapsed-lines":"10"}},[n("pre",null,[n("code",{class:"language-sql"},[n("span",{class:"line"},[n("span",{class:"token keyword"},"SET"),s(" foreign_key_checks "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"DROP"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token keyword"},"EXISTS"),s(" users"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"DROP"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token keyword"},"EXISTS"),s(" accounts"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"DROP"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token keyword"},"EXISTS"),s(),n("span",{class:"token keyword"},"transactions"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("users"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"AUTO_INCREMENT"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("name"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"VARCHAR"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"255"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("age"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"PRIMARY"),s(),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("accounts"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"AUTO_INCREMENT"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("title"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"VARCHAR"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"255"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"DEFAULT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("balance"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"DECIMAL"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"DEFAULT"),s(),n("span",{class:"token string"},"'0.00'"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"PRIMARY"),s(),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id_idx"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"CONSTRAINT"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"FOREIGN"),s(),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"REFERENCES"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("users"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"ON"),s(),n("span",{class:"token keyword"},"DELETE"),s(),n("span",{class:"token keyword"},"CASCADE")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"ON"),s(),n("span",{class:"token keyword"},"UPDATE"),s(),n("span",{class:"token keyword"},"CASCADE")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"TABLE"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("transactions"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"(")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"AUTO_INCREMENT"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("date_time"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"DATETIME"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("amount"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"DECIMAL"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),s(),n("span",{class:"token keyword"},"DEFAULT"),s(),n("span",{class:"token string"},"'0.00'"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("transaction_type"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"ENUM"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'deposit'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'withdrawal'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'transfer'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("account_id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("transfer_to_account_id"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"INT"),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"PRIMARY"),s(),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id_idx"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("account_id_idx"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("account_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"CONSTRAINT"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("transaction_user_id"),n("span",{class:"token punctuation"},"`")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"FOREIGN"),s(),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"REFERENCES"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("users"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"ON"),s(),n("span",{class:"token keyword"},"DELETE"),s(),n("span",{class:"token keyword"},"CASCADE")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"ON"),s(),n("span",{class:"token keyword"},"UPDATE"),s(),n("span",{class:"token keyword"},"CASCADE"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[s("  "),n("span",{class:"token keyword"},"CONSTRAINT"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("account_id"),n("span",{class:"token punctuation"},"`")])]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"FOREIGN"),s(),n("span",{class:"token keyword"},"KEY"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("account_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"REFERENCES"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("accounts"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"ON"),s(),n("span",{class:"token keyword"},"DELETE"),s(),n("span",{class:"token keyword"},"CASCADE")]),s(`
`),n("span",{class:"line"},[s("    "),n("span",{class:"token keyword"},"ON"),s(),n("span",{class:"token keyword"},"UPDATE"),s(),n("span",{class:"token keyword"},"CASCADE")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"LOCK"),s(),n("span",{class:"token keyword"},"TABLES"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("users"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"WRITE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"INSERT"),s(),n("span",{class:"token keyword"},"INTO"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("users"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"VALUES")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Иванов Иван Иванович'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"31"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Петров Петр Петрович'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"27"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Сидоров Сидор Сидорович'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"35"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"UNLOCK"),s(),n("span",{class:"token keyword"},"TABLES"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"LOCK"),s(),n("span",{class:"token keyword"},"TABLES"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("accounts"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"WRITE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"INSERT"),s(),n("span",{class:"token keyword"},"INTO"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("accounts"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"VALUES"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Основной'"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"10500.00"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Резервный'"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"3412.57"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Основной'"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"20750.00"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"4"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Основной'"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"25000.00"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},","),n("span",{class:"token string"},"'Накопительный'"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),n("span",{class:"token number"},"5401.75"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"UNLOCK"),s(),n("span",{class:"token keyword"},"TABLES"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"LOCK"),s(),n("span",{class:"token keyword"},"TABLES"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("transactions"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token keyword"},"WRITE"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"INSERT"),s(),n("span",{class:"token keyword"},"INTO"),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("transactions"),n("span",{class:"token punctuation"},"`")]),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("date_time"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("amount"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("transaction_type"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("user_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("account_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token identifier"},[n("span",{class:"token punctuation"},"`"),s("transfer_to_account_id"),n("span",{class:"token punctuation"},"`")]),n("span",{class:"token punctuation"},")")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"VALUES")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'2022-01-01 12:00:00'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"100.00"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'deposit'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'2022-01-02 15:30:00'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"50.00"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'withdrawal'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'2022-01-03 09:45:00'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"200.00"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'deposit'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'2022-01-04 14:20:00'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"75.00"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'withdrawal'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"NULL"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},",")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'2022-01-05 11:10:00'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"150.00"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'transfer'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"4"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"UNLOCK"),s(),n("span",{class:"token keyword"},"TABLES"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"}),s(`
`),n("span",{class:"line"},[n("span",{class:"token keyword"},"SET"),s(" foreign_key_checks "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";")]),s(`
`),n("span",{class:"line"})])]),n("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})]),n("div",{class:"collapsed-lines"})],-1)])]),tab2:t(({value:e,isActive:p})=>[c(i,{data:[{id:"<strong>users</strong>"},{id:"<strong>accounts</strong>"},{id:"<strong>transactions</strong>"}]},{title0:t(({value:l,isActive:o})=>[...a[4]||(a[4]=[n("strong",null,"users",-1)])]),title1:t(({value:l,isActive:o})=>[...a[5]||(a[5]=[n("strong",null,"accounts",-1)])]),title2:t(({value:l,isActive:o})=>[...a[6]||(a[6]=[n("strong",null,"transactions",-1)])]),tab0:t(({value:l,isActive:o})=>[...a[7]||(a[7]=[n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"right"}},"id"),n("th",{style:{"text-align":"left"}},"name"),n("th",{style:{"text-align":"right"}},"age")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"left"}},"Иванов Иван Иванович"),n("td",{style:{"text-align":"right"}},"31")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"left"}},"Петров Петр Петрович"),n("td",{style:{"text-align":"right"}},"27")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"3"),n("td",{style:{"text-align":"left"}},"Сидоров Сидор Сидорович"),n("td",{style:{"text-align":"right"}},"35")])])],-1)])]),tab1:t(({value:l,isActive:o})=>[...a[8]||(a[8]=[n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"right"}},"id"),n("th",{style:{"text-align":"left"}},"title"),n("th",{style:{"text-align":"right"}},"user_id"),n("th",{style:{"text-align":"right"}},"balance")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"left"}},"Основной"),n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"right"}},"10500")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"left"}},"Резервный"),n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"right"}},"3412.57")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"3"),n("td",{style:{"text-align":"left"}},"Основной"),n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"right"}},"20750")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"4"),n("td",{style:{"text-align":"left"}},"Основной"),n("td",{style:{"text-align":"right"}},"3"),n("td",{style:{"text-align":"right"}},"25000")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"5"),n("td",{style:{"text-align":"left"}},"Накопительный"),n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"right"}},"5401.75")])])],-1)])]),tab2:t(({value:l,isActive:o})=>[...a[9]||(a[9]=[n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"right"}},"id"),n("th",{style:{"text-align":"left"}},"date_time"),n("th",{style:{"text-align":"right"}},"amount"),n("th",{style:{"text-align":"left"}},"transaction_type"),n("th",{style:{"text-align":"right"}},"user_id"),n("th",{style:{"text-align":"right"}},"account_id"),n("th",{style:{"text-align":"right"}},"transfer_to_account_id")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"left"}},"2022-01-01 12:00:00"),n("td",{style:{"text-align":"right"}},"100"),n("td",{style:{"text-align":"left"}},"deposit"),n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"right"}},"nan")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"left"}},"2022-01-02 15:30:00"),n("td",{style:{"text-align":"right"}},"50"),n("td",{style:{"text-align":"left"}},"withdrawal"),n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"right"}},"1"),n("td",{style:{"text-align":"right"}},"nan")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"3"),n("td",{style:{"text-align":"left"}},"2022-01-03 09:45:00"),n("td",{style:{"text-align":"right"}},"200"),n("td",{style:{"text-align":"left"}},"deposit"),n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"right"}},"3"),n("td",{style:{"text-align":"right"}},"nan")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"4"),n("td",{style:{"text-align":"left"}},"2022-01-04 14:20:00"),n("td",{style:{"text-align":"right"}},"75"),n("td",{style:{"text-align":"left"}},"withdrawal"),n("td",{style:{"text-align":"right"}},"2"),n("td",{style:{"text-align":"right"}},"3"),n("td",{style:{"text-align":"right"}},"nan")]),n("tr",null,[n("td",{style:{"text-align":"right"}},"5"),n("td",{style:{"text-align":"left"}},"2022-01-05 11:10:00"),n("td",{style:{"text-align":"right"}},"150"),n("td",{style:{"text-align":"left"}},"transfer"),n("td",{style:{"text-align":"right"}},"3"),n("td",{style:{"text-align":"right"}},"4"),n("td",{style:{"text-align":"right"}},"5")])])],-1)])]),_:2},1024)]),_:1}),a[12]||(a[12]=y(`<p>Триггеры в MySQL 8 представляют собой специальные объекты базы данных, которые автоматически выполняются при определенных событиях или действиях с данными. Они позволяют программистам определить пользовательские действия, которые должны быть выполнены перед или после выполнения операции в базе данных. Иными словами, это определяемая пользователем SQL-команда, которая автоматически вызывается во время операций <code>INSERT</code>, <code>DELETE</code> или <code>UPDATE</code>. Код триггера связан с таблицей и уничтожается после удаления таблицы. Вы можете определить время действия триггера и указать, когда его нужно активировать — до или после определенного события базы данных.Поддержка триггеров в MySQL началась с версии 5.0.2</p><p>Триггеры имеют несколько преимуществ. Например, вы можете использовать их для генерации значения производного столбца во время выполнения <code>INSERT</code>. Еще один вариант использования триггера — обеспечение ссылочной целостности при сохранении записи в нескольких связанных таблицах. Также к преимуществам триггеров относятся регистрация действий пользователя для аудита таблиц и оперативное копирование данных в разных схемах баз данных для обеспечения избыточности и предотвращения единой точки отказа.</p><p>Вы также можете использовать триггеры, чтобы сохранить правила проверки на уровне базы данных. Это помогает избежать нарушения бизнес-логики при совместном использовании одного источника данных несколькими приложениями. Это значительно уменьшает количество обращений к серверу базы данных, что, в свою очередь, улучшает время отклика приложений. Поскольку сервер базы данных выполняет триггеры, они могут воспользоваться улучшенными ресурсами сервера, такими как RAM и CPU.</p><p>Общий синтаксис для создания триггера MySQL показан в следующем примере:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">DELIMITER</span> $$</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> <span class="token punctuation">[</span>TRIGGER_NAME<span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token keyword">TRIGGER</span> <span class="token keyword">TIME</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">TRIGGER</span> EVENT<span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">ON</span> <span class="token punctuation">[</span><span class="token keyword">TABLE</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">FOR EACH ROW</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token keyword">TRIGGER</span> BODY<span class="token punctuation">]</span>$$</span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Структура триггера включает:</p><ul><li><code>[TRIGGER_NAME]</code>: триггер должен иметь имя, и вы можете указать его именно здесь.</li><li><code>[TRIGGER TIME]</code>: триггер может быть вызван в разные моменты времени. MySQL позволяет определить, когда запускать триггер — до или после операции с базой данных (ключевые слова <code>BEFORE</code> / <code>AFTER</code>).</li><li><code>[TRIGGER EVENT]</code>: триггеры могут быть вызваны только операциями <code>INSERT</code>, <code>UPDATE</code> и <code>DELETE</code>. Вы можете использовать любое из значений в зависимости от того, чего вы хотите достичь, при этом стоит учесть что операции <code>CREATE</code>, <code>DROP</code> и <code>TRUNCATE</code> триггеров <strong>не вызывают</strong>.</li><li><code>[TABLE]</code>: любой триггер, который вы создаете в своей базе данных MySQL, должен быть связан с таблицей.</li><li><code>FOR EACH ROW</code>: этот оператор позволяет MySQL выполнять код триггера для каждой строки, на которую влияет триггер.</li><li><code>[TRIGGER BODY]</code>: код, который выполняется при вызове триггера, называется телом триггера. Это может быть один SQL-оператор или несколько команд. Обратите внимание, если вы выполняете несколько SQL-операторов в теле триггера, вы должны заключить их в блок <code>BEGIN... END</code> (по аналогии с хранимыми процедурами или функциями).</li></ul><div class="hint-container info"><p class="hint-container-title">Инфо</p><p>При создании тела триггера вы можете использовать ключевые слова <code>OLD</code> и <code>NEW</code> для доступа к старым и новым значениям колонки, введенным во время операции <code>INSERT</code>, <code>UPDATE</code> и <code>DELETE</code>. При этом, в триггере <code>DELETE</code> может быть использовано только ключевое слово <code>OLD</code>!</p></div><h2 id="примеры-триггеров-которые-можно-добавить-в-нашеи-бд" tabindex="-1"><a class="header-anchor" href="#примеры-триггеров-которые-можно-добавить-в-нашеи-бд"><span>Примеры триггеров, которые можно добавить в нашей БД</span></a></h2><ol><li>Триггер для обновления баланса счета после выполнения транзакции:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">DELIMITER</span> $$</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> update_balance</span>
<span class="line"><span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span></span>
<span class="line"><span class="token keyword">ON</span> <span class="token keyword">transactions</span></span>
<span class="line"><span class="token keyword">FOR EACH ROW</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">   <span class="token keyword">IF</span> NEW<span class="token punctuation">.</span>transaction_type <span class="token operator">=</span> <span class="token string">&#39;deposit&#39;</span> <span class="token keyword">THEN</span></span>
<span class="line">      <span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> NEW<span class="token punctuation">.</span>amount <span class="token keyword">WHERE</span> id <span class="token operator">=</span> NEW<span class="token punctuation">.</span>account_id<span class="token punctuation">;</span></span>
<span class="line">   <span class="token keyword">ELSEIF</span> NEW<span class="token punctuation">.</span>transaction_type <span class="token operator">=</span> <span class="token string">&#39;withdrawal&#39;</span> <span class="token keyword">THEN</span></span>
<span class="line">      <span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> NEW<span class="token punctuation">.</span>amount <span class="token keyword">WHERE</span> id <span class="token operator">=</span> NEW<span class="token punctuation">.</span>account_id<span class="token punctuation">;</span></span>
<span class="line">   <span class="token keyword">ELSEIF</span> NEW<span class="token punctuation">.</span>transaction_type <span class="token operator">=</span> <span class="token string">&#39;transfer&#39;</span> <span class="token keyword">THEN</span></span>
<span class="line">      <span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> NEW<span class="token punctuation">.</span>amount <span class="token keyword">WHERE</span> id <span class="token operator">=</span> NEW<span class="token punctuation">.</span>account_id<span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> NEW<span class="token punctuation">.</span>amount <span class="token keyword">WHERE</span> id <span class="token operator">=</span> NEW<span class="token punctuation">.</span>transfer_to_account_id<span class="token punctuation">;</span></span>
<span class="line">   <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span>$$</span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Как проверить:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>transactions<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>date_time<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>amount<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>transaction_type<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>account_id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>transfer_to_account_id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">VALUES</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000.00</span><span class="token punctuation">,</span> <span class="token string">&#39;deposit&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Вставляем тестовую транзакцию для пополнения счета и проверяем что, что баланс счета был обновлен:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> accounts <span class="token keyword">WHERE</span> account_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>Триггер для проверки остатка на счете перед выполнением операции снятия средств:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">DELIMITER</span> $$</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> check_balance</span>
<span class="line">BEFORE <span class="token keyword">INSERT</span></span>
<span class="line"><span class="token keyword">ON</span> <span class="token keyword">transactions</span></span>
<span class="line"><span class="token keyword">FOR EACH ROW</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">   <span class="token keyword">IF</span> NEW<span class="token punctuation">.</span>transaction_type <span class="token operator">=</span> <span class="token string">&#39;withdrawal&#39;</span> <span class="token operator">AND</span> NEW<span class="token punctuation">.</span>amount <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> balance <span class="token keyword">FROM</span> accounts <span class="token keyword">WHERE</span> id <span class="token operator">=</span> NEW<span class="token punctuation">.</span>account_id<span class="token punctuation">)</span> <span class="token keyword">THEN</span></span>
<span class="line">        SIGNAL SQLSTATE <span class="token string">&#39;45000&#39;</span> <span class="token keyword">SET</span> MESSAGE_TEXT <span class="token operator">=</span> <span class="token string">&#39;Недостаточно средств&#39;</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span>$$</span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Как проверить:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>transactions<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>date_time<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>amount<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>transaction_type<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>account_id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>transfer_to_account_id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">VALUES</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100000.00</span><span class="token punctuation">,</span> <span class="token string">&#39;withdrawal&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Вставляем тестовую транзакцию для снятия средств, в результате чего вы должны получить ошибку <code>&#39;Недостаточно средств&#39;</code>, так как на счету недостаточно средств для выполнения операции снятия.</p><ol start="3"><li>Триггер для автоматического обновления даты и времени транзакции при изменении записи:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">DELIMITER</span> $$</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> update_datetime</span>
<span class="line">BEFORE <span class="token keyword">UPDATE</span></span>
<span class="line"><span class="token keyword">ON</span> <span class="token keyword">transactions</span></span>
<span class="line"><span class="token keyword">FOR EACH ROW</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">   <span class="token keyword">SET</span> NEW<span class="token punctuation">.</span>date_time <span class="token operator">=</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span>$$</span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Как проверить:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>transactions<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>date_time<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>amount<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>transaction_type<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>account_id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>transfer_to_account_id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">VALUES</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500.00</span><span class="token punctuation">,</span> <span class="token string">&#39;transfer&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Проверяем дату и время транзакции:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">transactions</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> LAST_INSERT_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Вставляем тестовую транзакцию, затем обновляем запись в таблице <code>transactions</code></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">UPDATE</span> <span class="token identifier"><span class="token punctuation">\`</span>transactions<span class="token punctuation">\`</span></span> <span class="token keyword">SET</span> <span class="token identifier"><span class="token punctuation">\`</span>amount<span class="token punctuation">\`</span></span> <span class="token operator">=</span> <span class="token number">250</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> LAST_INSERT_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Проверяем снова, чтобы увидеть что дата и время транзакции были автоматически обновлены:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">transactions</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> LAST_INSERT_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="как-узнать-что-у-таблиц-в-mysql-есть-триггеры" tabindex="-1"><a class="header-anchor" href="#как-узнать-что-у-таблиц-в-mysql-есть-триггеры"><span>Как узнать что у таблиц в MySQL есть триггеры?</span></a></h2><p>Чтобы узнать, какие триггеры есть у таблиц в MySQL, можно выполнить следующий запрос:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SHOW</span> TRIGGERS <span class="token keyword">FROM</span> database_name<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Замените <code>database_name</code> на имя вашей базы данных. Этот запрос покажет список всех триггеров в указанной базе данных, включая таблицу, на которую они применяются, тип события (например, <code>INSERT</code>, <code>UPDATE</code> или <code>DELETE</code>), время выполнения (<code>BEFORE</code> или <code>AFTER</code>) и имя триггера.</p><h2 id="удаление-триггеров" tabindex="-1"><a class="header-anchor" href="#удаление-триггеров"><span>Удаление триггеров</span></a></h2><p>Как и любой другой объект базы данных, вы можете удалить триггеры с помощью команды <code>DROP</code>.</p><p>Синтаксис удаления триггера следующий:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> <span class="token punctuation">[</span><span class="token keyword">TRIGGER</span> NAME<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="транзакции-в-триггерах" tabindex="-1"><a class="header-anchor" href="#транзакции-в-триггерах"><span>Транзакции в триггерах</span></a></h2><p>В триггерах в MySQL можно использовать транзакции. Транзакции позволяют объединить несколько операций в одну логическую единицу работы, которая либо полностью выполняется, либо откатывается в случае ошибки.</p><p>В триггерах можно использовать следующие операторы для работы с транзакциями:</p><ul><li><code>START TRANSACTION</code>: начинает новую транзакцию.</li><li><code>COMMIT</code>: фиксирует изменения, сделанные в рамках текущей транзакции, и завершает ее успешно.</li><li><code>ROLLBACK</code>: отменяет все изменения, сделанные в рамках текущей транзакции, и завершает ее неудачно.</li></ul><p>Пример использования транзакций в триггерах:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> trigger_name</span>
<span class="line"><span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span></span>
<span class="line"><span class="token keyword">ON</span> table_name</span>
<span class="line"><span class="token keyword">FOR EACH ROW</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">   <span class="token keyword">DECLARE</span> <span class="token keyword">EXIT</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> SQLEXCEPTION</span>
<span class="line"></span>
<span class="line">   <span class="token keyword">BEGIN</span></span>
<span class="line">      <span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">RESIGNAL</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">   <span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">   <span class="token comment">-- выполнение операций</span></span>
<span class="line"></span>
<span class="line">   <span class="token keyword">COMMIT</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>В этом примере триггер начинает новую транзакцию с помощью <code>START TRANSACTION</code>, выполняет необходимые операции и фиксирует изменения с помощью <code>COMMIT</code>. В случае возникновения ошибки, триггер откатывает изменения с помощью <code>ROLLBACK</code>.</p><p><code>DECLARE EXIT HANDLER FOR SQLEXCEPTION</code> — это оператор, который объявляет обработчик исключений для текущего блока кода. В данном случае, мы объявляем обработчик исключений для ошибок, связанных с выполнением SQL-запросов (<code>SQLEXCEPTION</code>).</p><p><code>RESIGNAL</code> — это оператор, который вызывает повторное возбуждение исключения, которое было перехвачено в обработчике. Это позволяет передать исключение на уровень выше, чтобы оно могло быть обработано в другом месте.</p><p>В приведенном выше примере, если происходит исключение типа <code>SQLEXCEPTION</code> внутри блока кода триггера, то обработчик перехватывает его и выполняет операции в блоке <code>BEGIN ... END</code>. Затем, с помощью <code>ROLLBACK</code>, происходит откат транзакции, чтобы отменить все изменения, сделанные в рамках этой транзакции. После этого, с помощью <code>RESIGNAL</code>, исключение повторно возбуждается, чтобы оно могло быть обработано на уровне вызывающего кода.</p><p>Таким образом, триггеры в MySQL 8 предоставляют мощный инструмент для автоматизации и контроля операций с данными. Они могут быть использованы для выполнения различных задач, таких как обновление связанных таблиц, проверка целостности данных и многое другое.</p>`,49))])}const w=r(v,[["render",b]]),T=JSON.parse('{"path":"/disciplines/mdk1101/lectures/21_lecture.html","title":"МДК.11.01 - 21 - Триггеры","lang":"ru-RU","frontmatter":{"description":"МДК.11.01 - 21 - Триггеры Примеры данной темы используют учебную БД: Триггеры в MySQL 8 представляют собой специальные объекты базы данных, которые автоматически выполняются при...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"МДК.11.01 - 21 - Триггеры\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-24T14:30:06.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://it.vshp.online/disciplines/mdk1101/lectures/21_lecture.html"}],["meta",{"property":"og:site_name","content":"Кафедра ИТ"}],["meta",{"property":"og:title","content":"МДК.11.01 - 21 - Триггеры"}],["meta",{"property":"og:description","content":"МДК.11.01 - 21 - Триггеры Примеры данной темы используют учебную БД: Триггеры в MySQL 8 представляют собой специальные объекты базы данных, которые автоматически выполняются при..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ru-RU"}],["meta",{"property":"og:updated_time","content":"2025-10-24T14:30:06.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-24T14:30:06.000Z"}]]},"git":{"updatedTime":1761316206000,"contributors":[{"name":"PAVEL TKACHEV","username":"","email":"phoenixweiss@ya.ru","commits":1}],"changelog":[{"hash":"7164abf5ea181652ae6e18935015af58c1253ed4","time":1761316206000,"email":"phoenixweiss@ya.ru","author":"PAVEL TKACHEV","message":"Update 14_lecture.md, 15_lecture.md, 16_lecture.md, and 16 more files"}]},"autoDesc":true,"filePathRelative":"disciplines/mdk1101/lectures/21_lecture.md"}');export{w as comp,T as data};

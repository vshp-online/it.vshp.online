import{_ as e,c as p,a,b as s,e as n,o}from"./app-vTivps-k.js";const l={};function c(i,t){return o(),p("div",null,[...t[0]||(t[0]=[a('<h1 id="ит-03-07-агрегатные-функции-операторы-group-by-и-having" tabindex="-1"><a class="header-anchor" href="#ит-03-07-агрегатные-функции-операторы-group-by-и-having"><span>ИТ.03 - 07 - Агрегатные функции, операторы GROUP BY и HAVING</span></a></h1><h2 id="введение" tabindex="-1"><a class="header-anchor" href="#введение"><span>Введение</span></a></h2><p>На предыдущих занятиях вы освоили выборку и фильтрацию данных (<code>SELECT</code>, <code>WHERE</code>, <code>LIKE</code>, сортировку, ограничение выборки), а также модификаторы <code>DISTINCT</code> и работу с составными условиями. Сегодня — первый шаг к <strong>сводной аналитике по группам</strong>: агрегатные функции, группировка <code>GROUP BY</code> и постфильтрация групп <code>HAVING</code>.</p><p>Ключевые идеи темы:</p><ul><li><strong>Агрегатные функции</strong> вычисляют одно значение по набору строк: <code>COUNT</code>, <code>SUM</code>, <code>AVG</code>, <code>MIN</code>, <code>MAX</code>.</li><li><strong>GROUP BY</strong> объединяет строки в группы по заданному критерию.</li><li><strong>HAVING</strong> отбирает группы по условиям на агрегаты (в отличие от <code>WHERE</code>, который отбирает строки до группировки).</li><li>Порядок этапов выполнения запроса: <code>FROM</code> -&gt; <code>WHERE</code> -&gt; <code>GROUP BY</code> -&gt; <code>HAVING</code> -&gt; <code>ORDER BY</code> -&gt; <code>LIMIT</code>.</li></ul><h2 id="пример-таблицы-orders" tabindex="-1"><a class="header-anchor" href="#пример-таблицы-orders"><span>Пример таблицы <code>orders</code></span></a></h2><table><thead><tr><th>id</th><th>title</th><th>category</th><th>customer</th><th>amount</th></tr></thead><tbody><tr><td>1</td><td>Футболка BASIC</td><td>Одежда</td><td>ООО Альфа</td><td>5</td></tr><tr><td>2</td><td>носки хлопок</td><td>Одежда</td><td>ООО Бета</td><td>6</td></tr><tr><td>3</td><td>Шорты спортивные</td><td>Одежда</td><td>ИП Сокол</td><td>10</td></tr><tr><td>4</td><td>футболка Basic</td><td>Одежда</td><td>ООО Альфа</td><td>10</td></tr><tr><td>5</td><td>Шорты спортивные</td><td>Одежда</td><td>ЗАО Гелиос</td><td>5</td></tr><tr><td>6</td><td>Носки Хлопок</td><td>Одежда</td><td>ООО Бета</td><td>6</td></tr><tr><td>7</td><td>ФУТБОЛКА BASIC</td><td>Одежда</td><td>ООО Ромашка</td><td>5</td></tr><tr><td>8</td><td>Шорты спортивные</td><td>Одежда</td><td>ООО Вектор</td><td>5</td></tr><tr><td>9</td><td>Носки хлопок</td><td>Одежда</td><td>ИП Атлас</td><td>3</td></tr><tr><td>10</td><td>футболка BASIC</td><td>Одежда</td><td>ООО Альфа</td><td>5</td></tr><tr><td>11</td><td>Носки Хлопок</td><td>Одежда</td><td>ИП Атлас</td><td>3</td></tr><tr><td>12</td><td>Шорты спортивные</td><td>Одежда</td><td>ЗАО Гелиос</td><td>10</td></tr><tr><td>13</td><td>Футболка Basic</td><td>Одежда</td><td>ООО Альфа</td><td>5</td></tr><tr><td>14</td><td>Носки Хлопок</td><td>Одежда</td><td>ООО Бета</td><td>12</td></tr><tr><td>15</td><td>Шорты спортивные</td><td>Одежда</td><td>ООО Вектор</td><td>5</td></tr><tr><td>16</td><td>Кроссовки Trail</td><td>Обувь</td><td>ООО Бета</td><td>2</td></tr><tr><td>17</td><td>Кроссовки Trail</td><td>Обувь</td><td>ООО Альфа</td><td>2</td></tr><tr><td>18</td><td>Кроссовки Trail</td><td>Обувь</td><td>ИП Сокол</td><td>15</td></tr><tr><td>19</td><td>Кроссовки Trail</td><td>Обувь</td><td>ЗАО Гелиос</td><td>30</td></tr><tr><td>20</td><td>Кроссовки Trail</td><td>Обувь</td><td>ООО Ромашка</td><td>1</td></tr><tr><td>21</td><td>Джемпер шерстяной</td><td>Одежда</td><td>ООО Вектор</td><td>7</td></tr><tr><td>22</td><td>Джемпер шерстяной</td><td>Одежда</td><td>ООО Вектор</td><td>7</td></tr><tr><td>23</td><td>Джемпер шерстяной</td><td>Одежда</td><td>ООО Вектор</td><td>7</td></tr><tr><td>24</td><td>Шапка вязаная</td><td>Аксессуары</td><td>ООО Ромашка</td><td>1.</td></tr><tr><td>25</td><td>Шапка вязаная</td><td>Аксессуары</td><td>ООО Ромашка</td><td>1</td></tr><tr><td>26</td><td>Шапка вязаная</td><td>Аксессуары</td><td>ИП Атлас</td><td>1</td></tr><tr><td>27</td><td>Футболка BASIC</td><td>Одежда</td><td>ООО Альфа</td><td>20</td></tr><tr><td>28</td><td>Футболка Basic</td><td>Одежда</td><td>ЗАО Гелиос</td><td>8</td></tr><tr><td>29</td><td>Носки хлопок</td><td>Одежда</td><td>ООО Бета</td><td>1</td></tr><tr><td>30</td><td>Шорты спортивные</td><td>Одежда</td><td>ИП Сокол</td><td>12</td></tr><tr><td>31</td><td>Кеды Canvas</td><td>Обувь</td><td>ООО Альфа</td><td>4</td></tr><tr><td>32</td><td>Кеды Canvas</td><td>Обувь</td><td>ООО Ромашка</td><td>9</td></tr><tr><td>33</td><td>Рюкзак городской</td><td>Аксессуары</td><td>ООО Альфа</td><td>3</td></tr><tr><td>34</td><td>Рюкзак городской</td><td>Аксессуары</td><td>ЗАО Гелиос</td><td>6</td></tr><tr><td>35</td><td>Бутылка для воды</td><td>Спорт</td><td>ИП Атлас</td><td>12</td></tr><tr><td>36</td><td>Фитнес-резинка</td><td>Спорт</td><td>ООО Вектор</td><td>25</td></tr><tr><td>37</td><td>Перчатки лыжные</td><td>Аксессуары</td><td>ООО Бета</td><td>5</td></tr><tr><td>38</td><td>перчатки ЛЫЖНЫЕ</td><td>Аксессуары</td><td>ООО Бета</td><td>7</td></tr><tr><td>39</td><td>Кроссовки Trail</td><td>Обувь</td><td>ООО Вектор</td><td>11</td></tr><tr><td>40</td><td>Кроссовки Trail</td><td>Обувь</td><td>ИП Атлас</td><td>13</td></tr></tbody></table>',7),s("details",{class:"hint-container details"},[s("summary",null,"Код создания таблицы на языке SQL в диалекте SQLite"),s("div",{class:"language-sql line-numbers-mode","data-highlighter":"prismjs","data-ext":"sql"},[s("pre",null,[s("code",{class:"language-sql"},[s("span",{class:"line"},[s("span",{class:"token keyword"},"CREATE"),n(),s("span",{class:"token keyword"},"TABLE"),n(" orders "),s("span",{class:"token punctuation"},"(")]),n(`
`),s("span",{class:"line"},[n("  id "),s("span",{class:"token keyword"},"INTEGER"),n(),s("span",{class:"token keyword"},"PRIMARY"),n(),s("span",{class:"token keyword"},"KEY"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  title "),s("span",{class:"token keyword"},"TEXT"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  category "),s("span",{class:"token keyword"},"TEXT"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  customer "),s("span",{class:"token keyword"},"TEXT"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  amount "),s("span",{class:"token keyword"},"INTEGER")]),n(`
`),s("span",{class:"line"},[s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"}),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"INSERT"),n(),s("span",{class:"token keyword"},"INTO"),n(" orders "),s("span",{class:"token punctuation"},"("),n("id"),s("span",{class:"token punctuation"},","),n(" title"),s("span",{class:"token punctuation"},","),n(" category"),s("span",{class:"token punctuation"},","),n(" customer"),s("span",{class:"token punctuation"},","),n(" amount"),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token keyword"},"VALUES")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'Футболка BASIC'"),s("span",{class:"token punctuation"},","),n("         "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Альфа'"),s("span",{class:"token punctuation"},","),n("     "),s("span",{class:"token number"},"5"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"2"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'носки хлопок'"),s("span",{class:"token punctuation"},","),n("           "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Бета'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"6"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"3"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'Шорты спортивные'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ИП Сокол'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"10"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"4"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'футболка Basic'"),s("span",{class:"token punctuation"},","),n("         "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Альфа'"),s("span",{class:"token punctuation"},","),n("     "),s("span",{class:"token number"},"10"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"5"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'Шорты спортивные'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ЗАО Гелиос'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"5"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"6"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'Носки Хлопок'"),s("span",{class:"token punctuation"},","),n("           "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Бета'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"6"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"7"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'ФУТБОЛКА BASIC'"),s("span",{class:"token punctuation"},","),n("         "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Ромашка'"),s("span",{class:"token punctuation"},","),n("   "),s("span",{class:"token number"},"5"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"8"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'Шорты спортивные'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Вектор'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"5"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"9"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'Носки хлопок'"),s("span",{class:"token punctuation"},","),n("           "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ИП Атлас'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"3"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"10"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'футболка BASIC'"),s("span",{class:"token punctuation"},","),n("         "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Альфа'"),s("span",{class:"token punctuation"},","),n("     "),s("span",{class:"token number"},"5"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"11"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Носки Хлопок'"),s("span",{class:"token punctuation"},","),n("           "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ИП Атлас'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"3"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"12"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Шорты спортивные'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ЗАО Гелиос'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"10"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"13"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Футболка Basic'"),s("span",{class:"token punctuation"},","),n("         "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Альфа'"),s("span",{class:"token punctuation"},","),n("     "),s("span",{class:"token number"},"5"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"14"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Носки Хлопок'"),s("span",{class:"token punctuation"},","),n("           "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Бета'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"12"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"15"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Шорты спортивные'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Вектор'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"5"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"16"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Кроссовки Trail'"),s("span",{class:"token punctuation"},","),n("        "),s("span",{class:"token string"},"'Обувь'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ООО Бета'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"2"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"17"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Кроссовки Trail'"),s("span",{class:"token punctuation"},","),n("        "),s("span",{class:"token string"},"'Обувь'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ООО Альфа'"),s("span",{class:"token punctuation"},","),n("     "),s("span",{class:"token number"},"2"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"18"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Кроссовки Trail'"),s("span",{class:"token punctuation"},","),n("        "),s("span",{class:"token string"},"'Обувь'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ИП Сокол'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"15"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"19"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Кроссовки Trail'"),s("span",{class:"token punctuation"},","),n("        "),s("span",{class:"token string"},"'Обувь'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ЗАО Гелиос'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"30"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"20"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Кроссовки Trail'"),s("span",{class:"token punctuation"},","),n("        "),s("span",{class:"token string"},"'Обувь'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ООО Ромашка'"),s("span",{class:"token punctuation"},","),n("   "),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"21"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Джемпер шерстяной'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Вектор'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"7"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"22"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Джемпер шерстяной'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Вектор'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"7"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"23"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Джемпер шерстяной'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Вектор'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"7"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"24"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Шапка вязаная'"),s("span",{class:"token punctuation"},","),n("          "),s("span",{class:"token string"},"'Аксессуары'"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'ООО Ромашка'"),s("span",{class:"token punctuation"},","),n("   "),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"25"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Шапка вязаная'"),s("span",{class:"token punctuation"},","),n("          "),s("span",{class:"token string"},"'Аксессуары'"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'ООО Ромашка'"),s("span",{class:"token punctuation"},","),n("   "),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"26"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Шапка вязаная'"),s("span",{class:"token punctuation"},","),n("          "),s("span",{class:"token string"},"'Аксессуары'"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'ИП Атлас'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"27"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Футболка BASIC'"),s("span",{class:"token punctuation"},","),n("         "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Альфа'"),s("span",{class:"token punctuation"},","),n("     "),s("span",{class:"token number"},"20"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"28"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Футболка Basic'"),s("span",{class:"token punctuation"},","),n("         "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ЗАО Гелиос'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"8"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"29"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Носки хлопок'"),s("span",{class:"token punctuation"},","),n("           "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ООО Бета'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"30"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Шорты спортивные'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'Одежда'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token string"},"'ИП Сокол'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"12"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"31"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Кеды Canvas'"),s("span",{class:"token punctuation"},","),n("            "),s("span",{class:"token string"},"'Обувь'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ООО Альфа'"),s("span",{class:"token punctuation"},","),n("     "),s("span",{class:"token number"},"4"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"32"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Кеды Canvas'"),s("span",{class:"token punctuation"},","),n("            "),s("span",{class:"token string"},"'Обувь'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ООО Ромашка'"),s("span",{class:"token punctuation"},","),n("   "),s("span",{class:"token number"},"9"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"33"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Рюкзак городской'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'Аксессуары'"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'ООО Альфа'"),s("span",{class:"token punctuation"},","),n("     "),s("span",{class:"token number"},"3"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"34"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Рюкзак городской'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'Аксессуары'"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'ЗАО Гелиос'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"6"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"35"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Бутылка для воды'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'Спорт'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ИП Атлас'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"12"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"36"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Фитнес-резинка'"),s("span",{class:"token punctuation"},","),n("         "),s("span",{class:"token string"},"'Спорт'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ООО Вектор'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"25"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"37"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Перчатки лыжные'"),s("span",{class:"token punctuation"},","),n("        "),s("span",{class:"token string"},"'Аксессуары'"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'ООО Бета'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"5"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"38"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'перчатки ЛЫЖНЫЕ'"),s("span",{class:"token punctuation"},","),n("        "),s("span",{class:"token string"},"'Аксессуары'"),s("span",{class:"token punctuation"},","),n("  "),s("span",{class:"token string"},"'ООО Бета'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"7"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"39"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Кроссовки Trail'"),s("span",{class:"token punctuation"},","),n("        "),s("span",{class:"token string"},"'Обувь'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ООО Вектор'"),s("span",{class:"token punctuation"},","),n("    "),s("span",{class:"token number"},"11"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"40"),s("span",{class:"token punctuation"},","),n(),s("span",{class:"token string"},"'Кроссовки Trail'"),s("span",{class:"token punctuation"},","),n("        "),s("span",{class:"token string"},"'Обувь'"),s("span",{class:"token punctuation"},","),n("       "),s("span",{class:"token string"},"'ИП Атлас'"),s("span",{class:"token punctuation"},","),n("      "),s("span",{class:"token number"},"13"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"})])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])]),s("codapi-snippet",{sandbox:"sqlite",editor:"basic",id:"orders_02_sqlite.sql"})],-1),a(`<h2 id="агрегатные-функции-обзор" tabindex="-1"><a class="header-anchor" href="#агрегатные-функции-обзор"><span>Агрегатные функции: обзор</span></a></h2><blockquote><p>Агрегатная функция — это функция, которая выполняет вычисление на наборе значений и возвращает одиночное значение.</p></blockquote><p>В разных СУБД существует довольно много разных агрегатных функций, но мы рассмотрим основные:</p><table><thead><tr><th>Функция</th><th>Что считает</th><th>Учитывает <code>NULL</code></th></tr></thead><tbody><tr><td><code>COUNT(*)</code></td><td>Число строк</td><td>Да</td></tr><tr><td><code>COUNT(col)</code></td><td>Число <strong>ненулевых</strong> значений в столбце</td><td>Нет</td></tr><tr><td><code>COUNT(DISTINCT x)</code></td><td>Число <strong>уникальных</strong> ненулевых значений <code>x</code></td><td>Нет</td></tr><tr><td><code>SUM(col)</code></td><td>Сумма значений</td><td>Нет</td></tr><tr><td><code>AVG(col)</code></td><td>Среднее</td><td>Нет</td></tr><tr><td><code>MIN(col)</code></td><td>Минимум</td><td>Нет</td></tr><tr><td><code>MAX(col)</code></td><td>Максимум</td><td>Нет</td></tr></tbody></table><h3 id="базовые-примеры-без-группировки" tabindex="-1"><a class="header-anchor" href="#базовые-примеры-без-группировки"><span>Базовые примеры (без группировки)</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> total_orders</span>
<span class="line"><span class="token keyword">FROM</span> orders<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,6),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Сколько всего строк (заказов) в таблице.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_qty</span>
<span class="line"><span class="token keyword">FROM</span> orders<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,2),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Сколько единиц товара продано суммарно.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> category<span class="token punctuation">)</span> <span class="token keyword">AS</span> unique_categories</span>
<span class="line"><span class="token keyword">FROM</span> orders<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,2),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Сколько различных категорий товаров встречается в заказах.</p><h2 id="группировка-group-by" tabindex="-1"><a class="header-anchor" href="#группировка-group-by"><span>Группировка <code>GROUP BY</code></span></a></h2><p>Оператор <code>GROUP BY</code> объединяет данные с одинаковым ключом в <strong>группы</strong>, после чего в <code>SELECT</code> допустимы:</p><ul><li>столбцы из списка группировки;</li><li><strong>агрегатные</strong> выражения по строкам внутри группы.</li></ul><h3 id="простеишая-группировка-по-товару" tabindex="-1"><a class="header-anchor" href="#простеишая-группировка-по-товару"><span>Простейшая группировка по товару</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span></span>
<span class="line">  title<span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_qty</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> title</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total_qty <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Сколько единиц каждого товара продано суммарно.</p><h3 id="группировка-по-покупателю" tabindex="-1"><a class="header-anchor" href="#группировка-по-покупателю"><span>Группировка по покупателю</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span></span>
<span class="line">  customer<span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_qty</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customer</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total_qty <span class="token keyword">DESC</span><span class="token punctuation">,</span> customer <span class="token keyword">ASC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Сколько единиц заказал каждый покупатель.</p><h3 id="группировка-по-категории" tabindex="-1"><a class="header-anchor" href="#группировка-по-категории"><span>Группировка по категории</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span></span>
<span class="line">  category<span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_qty</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> category</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total_qty <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Суммарные продажи по категориям.</p><h3 id="группировка-по-двум-ключам-покупатель-×-категория" tabindex="-1"><a class="header-anchor" href="#группировка-по-двум-ключам-покупатель-×-категория"><span>Группировка по двум ключам (покупатель × категория)</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span></span>
<span class="line">  customer<span class="token punctuation">,</span></span>
<span class="line">  category<span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_qty</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customer<span class="token punctuation">,</span> category</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> customer <span class="token keyword">ASC</span><span class="token punctuation">,</span> total_qty <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Сколько покупатель взял по каждой категории</p><h3 id="заказы-на-каждыи-товар" tabindex="-1"><a class="header-anchor" href="#заказы-на-каждыи-товар"><span>Заказы на каждый товар</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span></span>
<span class="line">  title<span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> orders_count</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> title</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> orders_count <span class="token keyword">DESC</span><span class="token punctuation">,</span> title <span class="token keyword">ASC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Сколько заказов пришлось на каждый товар.</p><h3 id="среднии-размер-заказа" tabindex="-1"><a class="header-anchor" href="#среднии-размер-заказа"><span>Средний размер заказа</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span></span>
<span class="line">  category<span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">AVG</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_per_category</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> title</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> avg_per_category <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Средний размер заказа по каждой категории</p><h3 id="группировка-по-выражению" tabindex="-1"><a class="header-anchor" href="#группировка-по-выражению"><span>Группировка по выражению</span></a></h3><div class="hint-container tip"><p class="hint-container-title">Совет</p><p>В SQLite существует функция <code>LOWER(col)</code>, которая приводит переданное ей значение к нижнему регистру. Однако, следует помнить что она не работает для кириллицы!</p></div><p>Группировать можно по вычисляемому выражению, например по «нормализованному» названию:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span></span>
<span class="line">  LOWER<span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token keyword">AS</span> norm_title<span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span>  <span class="token keyword">AS</span> total_qty</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> LOWER<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total_qty <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Объединены возможные варианты регистра в одно наименование (без учёта кириллицы).</p><div class="hint-container warning"><p class="hint-container-title">Примечание</p><p>Примечание о разных СУБД: в SQLite допускается выбирать в <code>SELECT</code> столбцы, которых нет в <code>GROUP BY</code>, но их значения <strong>недетерминированы</strong>; в MySQL с включённым режимом <code>ONLY_FULL_GROUP_BY</code> это приведёт к ошибке. Безопасная практика: в <code>SELECT</code> — только поля группировки и агрегаты.</p></div><hr><h2 id="where-vs-having" tabindex="-1"><a class="header-anchor" href="#where-vs-having"><span><code>WHERE</code> vs <code>HAVING</code></span></a></h2><ul><li><code>WHERE</code> фильтрует <strong>строки до</strong> группировки.</li><li><code>HAVING</code> фильтрует <strong>группы после</strong> вычисления агрегатов.</li></ul><h3 id="пример-1-отобрать-«крупные»-строки-заказов" tabindex="-1"><a class="header-anchor" href="#пример-1-отобрать-«крупные»-строки-заказов"><span>Пример 1. Отобрать «крупные» <strong>строки</strong> заказов</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span></span>
<span class="line">  title<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_qty</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">WHERE</span> amount <span class="token operator">&gt;=</span> <span class="token number">10</span></span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> title<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Только те строки, где amount &gt;= 10 (до группировки).</p><h3 id="пример-2-отобрать-«крупные»-товары-по-итогу" tabindex="-1"><a class="header-anchor" href="#пример-2-отобрать-«крупные»-товары-по-итогу"><span>Пример 2. Отобрать «крупные» <strong>товары по итогу</strong></span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span></span>
<span class="line">  title<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_qty</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> title</span>
<span class="line"><span class="token comment">-- допустимо также: HAVING total_qty &gt;= 25 в SQLite/MySQL</span></span>
<span class="line"><span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">25</span></span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total_qty <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Все строки учитываются, но оставляем только те группы, где суммарные продажи по товару &gt;= 25.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> customer<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> orders_count</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customer</span>
<span class="line"><span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Клиенты, у которых не менее 3 заказов.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> category<span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> min_per_category</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> category</span>
<span class="line"><span class="token keyword">HAVING</span> <span class="token function">MIN</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Категории, в которых минимальный размер заказа не ниже 5.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> category<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_per_category</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> category</span>
<span class="line"><span class="token keyword">HAVING</span> <span class="token function">AVG</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token operator">BETWEEN</span> <span class="token number">5</span> <span class="token operator">AND</span> <span class="token number">8</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Средний размер заказа на категорию в пределах от 5 до 8 включительно.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> customer<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_qty</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customer</span>
<span class="line"><span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">40</span></span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total_qty <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Покупатели с суммарными закупками не менее 40 единиц</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> category<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rows_cnt</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> category</span>
<span class="line"><span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">3</span></span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> rows_cnt <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Категории, по которым сделано не менее 3 строк заказов</p><h3 id="having-без-group-by" tabindex="-1"><a class="header-anchor" href="#having-без-group-by"><span><code>HAVING</code> без <code>GROUP BY</code></span></a></h3><p>Можно фильтровать агрегат по <strong>всей таблице</strong> одной строкой результата:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_qty</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1),a(`<p><strong>Результат:</strong><br> Показать суммарные продажи только если они превышают 60.</p><hr><h2 id="порядок-и-«скелет»-запроса-своднои-аналитики" tabindex="-1"><a class="header-anchor" href="#порядок-и-«скелет»-запроса-своднои-аналитики"><span>Порядок и «скелет» запроса сводной аналитики</span></a></h2><ol><li>Сформулировать вопрос на обычном языке.</li><li>Выбрать ключ группировки.</li><li>Выбрать агрегаты.</li><li>Доп-фильтры по строкам (<code>WHERE</code>).</li><li>Фильтр по итогам групп (<code>HAVING</code>).</li><li>Сортировка результатов (<code>ORDER BY</code>) и порог (<code>LIMIT</code>).</li></ol><p>Шаблон:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> group_key<span class="token punctuation">,</span> AGG<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> metric<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"><span class="token keyword">FROM</span> <span class="token keyword">table</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token keyword">WHERE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> group_key</span>
<span class="line"><span class="token punctuation">[</span><span class="token keyword">HAVING</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> metric <span class="token keyword">DESC</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">[</span><span class="token keyword">LIMIT</span> N<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="типичные-ошибки-и-как-их-избежать" tabindex="-1"><a class="header-anchor" href="#типичные-ошибки-и-как-их-избежать"><span>Типичные ошибки и как их избежать</span></a></h2><ul><li><strong>Выбор неагрегированных полей вне <code>GROUP BY</code>.</strong> Работает не везде / даёт недетерминированные значения. Решение: добавьте поле в <code>GROUP BY</code> или заверните в агрегат/выражение.</li><li><strong>Использование <code>HAVING</code> вместо <code>WHERE</code> для построчных условий.</strong> Если критерий относится к строкам (напр. <code>amount &gt;= 10</code>) — это <code>WHERE</code>. Если к агрегатам группы (<code>SUM(amount) &gt;= 25</code>) — это <code>HAVING</code>.</li><li><strong>Неуправляемый порядок строк.</strong> Добавляйте явный <code>ORDER BY</code> по метрике/ключу.</li><li><strong>Смешение регистров/вариантов написания ключа группировки.</strong> Нормализуйте (<code>LOWER(...)</code>, <code>TRIM(...)</code>) в <code>GROUP BY</code>.</li></ul><hr><h2 id="практикум" tabindex="-1"><a class="header-anchor" href="#практикум"><span>Практикум</span></a></h2><ol><li>Суммарные продажи по каждому товару (title), по убыванию суммы.</li><li>Покупатели с не менее чем тремя строками заказов.</li><li>Топ‑N покупателей по суммарным продажам; покажите сумму и число строк.</li><li>Категории с суммарными продажами ≥ 50.</li><li>Средний размер строки заказа по каждому покупателю.</li><li>Минимальный и максимальный размер строки по каждому товару.</li><li>Число <strong>уникальных</strong> покупателей и число <strong>уникальных</strong> товаров.</li><li>Нормализуйте наименования (<code>LOWER(title)</code>) и пересчитайте продажи по товарам.</li><li>Матрица покупатель × категория с суммой; выведите только ячейки с суммой &gt; 0.</li><li>Топ‑1 товар и топ‑1 покупатель по суммарным продажам (двумя запросами).</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token comment">-- Ваш код можете писать тут</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13),s("codapi-snippet",{sandbox:"sqlite",editor:"basic","depends-on":"orders_02_sqlite.sql"},null,-1)])])}const u=e(l,[["render",c]]),r=JSON.parse('{"path":"/disciplines/it03/lectures/07_lecture.html","title":"ИТ.03 - 07 - Агрегатные функции, операторы GROUP BY и HAVING","lang":"ru-RU","frontmatter":{"description":"ИТ.03 - 07 - Агрегатные функции, операторы GROUP BY и HAVING Введение На предыдущих занятиях вы освоили выборку и фильтрацию данных (SELECT, WHERE, LIKE, сортировку, ограничение...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ИТ.03 - 07 - Агрегатные функции, операторы GROUP BY и HAVING\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-23T06:29:10.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://it.vshp.online/disciplines/it03/lectures/07_lecture.html"}],["meta",{"property":"og:site_name","content":"Кафедра ИТ"}],["meta",{"property":"og:title","content":"ИТ.03 - 07 - Агрегатные функции, операторы GROUP BY и HAVING"}],["meta",{"property":"og:description","content":"ИТ.03 - 07 - Агрегатные функции, операторы GROUP BY и HAVING Введение На предыдущих занятиях вы освоили выборку и фильтрацию данных (SELECT, WHERE, LIKE, сортировку, ограничение..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ru-RU"}],["meta",{"property":"og:updated_time","content":"2025-10-23T06:29:10.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-23T06:29:10.000Z"}]]},"git":{"updatedTime":1761200950000,"contributors":[{"name":"PAVEL TKACHEV","username":"","email":"phoenixweiss@ya.ru","commits":2}],"changelog":[{"hash":"ee4177d3bc5f5dd8ff575610791788e2fe451011","time":1761200950000,"email":"phoenixweiss@ya.ru","author":"PAVEL TKACHEV","message":"Update 07_lecture.md, orders_02_sqlite.sql, and table_orders_02.md"},{"hash":"ab5fd36737a0ea60ccccb52a8f0146255c9a349b","time":1761149769000,"email":"phoenixweiss@ya.ru","author":"PAVEL TKACHEV","message":"Update settings.json, <a href=\\"http://index.md\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">index.md</a>, 06_lecture.md, and 4 more files"}]},"autoDesc":true,"filePathRelative":"disciplines/it03/lectures/07_lecture.md"}');export{u as comp,r as data};

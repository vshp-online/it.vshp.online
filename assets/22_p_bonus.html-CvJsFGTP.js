import{_ as n,c as a,a as e,o as p}from"./app-Cku2TPGJ.js";const t={};function l(o,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="мдк-11-01-bonus-проверка-существования-записеи" tabindex="-1"><a class="header-anchor" href="#мдк-11-01-bonus-проверка-существования-записеи"><span>МДК.11.01 - BONUS. Проверка существования записей</span></a></h1><h2 id="как-проверить-есть-ли-запись-в-таблице" tabindex="-1"><a class="header-anchor" href="#как-проверить-есть-ли-запись-в-таблице"><span>Как проверить, есть ли запись в таблице?</span></a></h2><p>Иногда нужно понять, существует ли связь между данными в таблице. Например, в таблице заказов мы хотим проверить, делал ли покупатель уже заказ на определённый товар. Вот простой подход, который поможет это сделать.</p><hr><h2 id="пример-задачи" tabindex="-1"><a class="header-anchor" href="#пример-задачи"><span>Пример задачи</span></a></h2><p>Таблица заказов:</p><table><thead><tr><th>order_id</th><th>customer_id</th><th>product_id</th><th>quantity</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>101</td><td>2</td></tr><tr><td>2</td><td>2</td><td>102</td><td>1</td></tr><tr><td>3</td><td>1</td><td>103</td><td>5</td></tr><tr><td>4</td><td>1</td><td>101</td><td>3</td></tr><tr><td>5</td><td>3</td><td>104</td><td>7</td></tr></tbody></table><p><strong>Вопросы:</strong></p><ol><li>Покупал ли клиент с <code>customer_id = 1</code> товар с <code>product_id = 101</code>? (Есть несколько записей)</li><li>Покупал ли клиент с <code>customer_id = 2</code> товар с <code>product_id = 103</code>? (Нет записей)</li><li>Покупал ли клиент с <code>customer_id = 3</code> товар с <code>product_id = 104</code>? (Есть одна запись)</li></ol><hr><h2 id="подход-к-решению" tabindex="-1"><a class="header-anchor" href="#подход-к-решению"><span>Подход к решению</span></a></h2><p>Мы считаем количество записей, соответствующих условиям. Вот запрос:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> record_count</span>
<span class="line"><span class="token keyword">FROM</span> orders</span>
<span class="line"><span class="token keyword">WHERE</span> customer_id <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> product_id <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Результаты:</strong></p><ul><li><code>record_count = 0</code> — клиент ещё не покупал этот товар.</li><li><code>record_count = 1</code> — клиент покупал этот товар один раз.</li><li><code>record_count &gt; 1</code> — клиент покупал этот товар несколько раз.</li></ul><hr><h2 id="пример-использования-в-процедуре" tabindex="-1"><a class="header-anchor" href="#пример-использования-в-процедуре"><span>Пример использования в процедуре</span></a></h2><p>Автоматизируем проверку и добавление заказа:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">DELIMITER</span> <span class="token comment">//</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> add_order<span class="token punctuation">(</span></span>
<span class="line">    <span class="token operator">IN</span> p_customer_id <span class="token keyword">INT</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token operator">IN</span> p_product_id <span class="token keyword">INT</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token operator">IN</span> p_quantity <span class="token keyword">INT</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">DECLARE</span> record_count <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">-- Считаем количество подходящих записей</span></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">INTO</span> record_count</span>
<span class="line">    <span class="token keyword">FROM</span> orders</span>
<span class="line">    <span class="token keyword">WHERE</span> customer_id <span class="token operator">=</span> p_customer_id <span class="token operator">AND</span> product_id <span class="token operator">=</span> p_product_id<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">-- Проверяем результат</span></span>
<span class="line">    <span class="token keyword">IF</span> record_count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">THEN</span></span>
<span class="line">        SIGNAL SQLSTATE <span class="token string">&#39;45000&#39;</span></span>
<span class="line">        <span class="token keyword">SET</span> MESSAGE_TEXT <span class="token operator">=</span> <span class="token string">&#39;Заказ уже существует&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">ELSE</span></span>
<span class="line">        <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders <span class="token punctuation">(</span>customer_id<span class="token punctuation">,</span> product_id<span class="token punctuation">,</span> quantity<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>p_customer_id<span class="token punctuation">,</span> p_product_id<span class="token punctuation">,</span> p_quantity<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> <span class="token comment">//</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="тестовая-база-данных" tabindex="-1"><a class="header-anchor" href="#тестовая-база-данных"><span>Тестовая база данных</span></a></h2><p>Создадим таблицу и наполним её данными для проверки:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token comment">-- Создание базы данных</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> test_db<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">USE</span> test_db<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Создание таблицы заказов</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders <span class="token punctuation">(</span></span>
<span class="line">    order_id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></span>
<span class="line">    customer_id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    product_id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></span>
<span class="line">    quantity <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Наполнение таблицы данными</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders <span class="token punctuation">(</span>customer_id<span class="token punctuation">,</span> product_id<span class="token punctuation">,</span> quantity<span class="token punctuation">)</span> <span class="token keyword">VALUES</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="проверка" tabindex="-1"><a class="header-anchor" href="#проверка"><span>Проверка</span></a></h2><ol><li>Если записи несколько:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">CALL</span> add_order<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">-- Выдаст ошибку: &quot;Заказ уже существует&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Если записи нет:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">CALL</span> add_order<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">-- Успешно добавит новый заказ.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Если запись одна:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">CALL</span> add_order<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">-- Выдаст ошибку: &quot;Заказ уже существует&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>Этот подход помогает просто и надёжно проверить наличие данных и избежать дублирования записей. Вы можете использовать его как основу для множества задач, связанных с проверкой связей в таблицах.</p>`,33)])])}const i=n(t,[["render",l]]),d=JSON.parse('{"path":"/disciplines/mdk1101/lectures/22_p_bonus.html","title":"МДК.11.01 - BONUS. Проверка существования записей","lang":"ru-RU","frontmatter":{"description":"МДК.11.01 - BONUS. Проверка существования записей Как проверить, есть ли запись в таблице? Иногда нужно понять, существует ли связь между данными в таблице. Например, в таблице ...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"МДК.11.01 - BONUS. Проверка существования записей\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-24T14:30:06.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://it.vshp.online/disciplines/mdk1101/lectures/22_p_bonus.html"}],["meta",{"property":"og:site_name","content":"Кафедра ИТ"}],["meta",{"property":"og:title","content":"МДК.11.01 - BONUS. Проверка существования записей"}],["meta",{"property":"og:description","content":"МДК.11.01 - BONUS. Проверка существования записей Как проверить, есть ли запись в таблице? Иногда нужно понять, существует ли связь между данными в таблице. Например, в таблице ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ru-RU"}],["meta",{"property":"og:updated_time","content":"2025-10-24T14:30:06.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-24T14:30:06.000Z"}]]},"git":{"updatedTime":1761316206000,"contributors":[{"name":"PAVEL TKACHEV","username":"","email":"phoenixweiss@ya.ru","commits":1}],"changelog":[{"hash":"7164abf5ea181652ae6e18935015af58c1253ed4","time":1761316206000,"email":"phoenixweiss@ya.ru","author":"PAVEL TKACHEV","message":"Update 14_lecture.md, 15_lecture.md, 16_lecture.md, and 16 more files"}]},"autoDesc":true,"filePathRelative":"disciplines/mdk1101/lectures/22_p_bonus.md"}');export{i as comp,d as data};

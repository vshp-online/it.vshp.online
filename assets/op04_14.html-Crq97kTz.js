import{_ as e,c as p,a as s,b as t,d as c,w as l,r as o,o as i,e as u}from"./app-CRAEKUA-.js";const r={};function d(k,n){const a=o("RouteLink");return i(),p("div",null,[n[1]||(n[1]=s('<div class="hint-container warning"><p class="hint-container-title">Примечание</p><p><strong>ЭТО АРХИВНАЯ ВЕРСИЯ КУРСА!</strong></p><p>Материалы предназначаются для пересдающих дисциплину &quot;ОП.04 - Основы алгоритмизации и программирования&quot; в соответствии с учебными планами СПО годов набора <strong>ДО 2023-го</strong>.</p><p>Материалы были перенесены со старого сайта с минимальной доработкой, поэтому не все возможности курса могут работать как ожидается, где-то может слететь форматирование.</p><p><strong>Домашние задания в рамках курса проверяться не будут!</strong></p></div><h1 id="оп-04-14-порядок-выполнения-и-прерывания-виды-ошибок-в-программировании-и-способы-отладки" tabindex="-1"><a class="header-anchor" href="#оп-04-14-порядок-выполнения-и-прерывания-виды-ошибок-в-программировании-и-способы-отладки"><span>ОП.04 - 14 - Порядок выполнения и прерывания. Виды ошибок в программировании и способы отладки</span></a></h1>',2)),t("p",null,[c(a,{to:"/disciplines/op04/includes/_html_example.html",title:":include"},{default:l(()=>[...n[0]||(n[0]=[u("Код примера для практической работы",-1)])]),_:1})]),n[2]||(n[2]=s(`<h2 id="порядок-выполнения-и-прерывания" tabindex="-1"><a class="header-anchor" href="#порядок-выполнения-и-прерывания"><span>Порядок выполнения и прерывания</span></a></h2><blockquote><p><strong>Порядок выполнения</strong> — это способ упорядочения инструкций программы в процессе её выполнения.</p></blockquote><p>Инструкции, входящие в программу, могут исполняться как последовательно, одна за другой, так и одновременно (параллельно); как однократно, так и многократно; последовательность исполнения инструкций может совпадать с последовательностью их расположения в записи программы или не совпадать, а также зависеть как от текущего состояния вычислений, так и от внешних событий, образовывая, таким образом, разнообразные порядки выполнения инструкций.</p><p>Организация желаемого порядка выполнения может быть осуществлена с помощью различных механизмов, таких как специализированные инструкции или управляющие конструкции высокоуровневых языков программирования или встроенные в вычислитель механизмы для прерывания, сохранения и восстановления состояния, модификация и генерация инструкций программы и пр.</p><p>Характеристика порядка выполнения и контроля за этим порядком характерна для <em>императивного программирования</em>.</p><blockquote><p><strong>Императивное программирование</strong> (англ. imperative — приказ, повелительное наклонение) — это парадигма программирования (стиль написания исходного кода компьютерной программы), для которой характерно следующее:</p><ul><li>в исходном коде программы записываются инструкции (команды);</li><li>инструкции должны выполняться последовательно;</li><li>данные, получаемые при выполнении предыдущих инструкций, могут читаться из памяти последующими инструкциями;</li><li>данные, полученные при выполнении инструкции, могут записываться в память.</li></ul></blockquote><p>Императивному подходу в программировании противопоставляется декларативный подход, в рамках которого описывается набор условий и результат а не путь его достижения. В рамках декларативного подхода объединены такие множество других, наиболее популярные из которых — объектно-ориентированное программирование и функциональное программирование. Однако, в рамках данного курса данные подходы не рассматриваются.</p><p>В императивном программировании предполагается, что процесс выполнения программы заключается в выполнении её инструкций вычислителем. В момент выполнения инструкции говорят, что она управляет вычислителем, переход к выполнению следующей называется передача управления или просто переход. Последовательность передач управления в процессе выполнения программы формирует её поток управления (также поток выполнения).</p><p>Способность вычислителя выбирать инструкции для выполнения в зависимости от своего состояния, а также возможность одновременного выполнения нескольких инструкций порождают существование разветвлённых (которые могут быть выполнены при определённых условиях) и параллельных (выполняющихся одновременно) связанных и взаимодействующих между собой потоков управления в одной программе.</p><p>Совокупность потоков программы, образующих разнообразные порядки, может быть изображена в виде ориентированного графа, где узлы соответствуют инструкциям программы, а ребра — переходам между ними.</p><figure><img src="https://upload.wikimedia.org/wikipedia/commons/4/48/Control-flow-sample.svg" alt="управление потоком | md" tabindex="0" loading="lazy"><figcaption>управление потоком | md</figcaption></figure><p><em>Изображение порядка выполнения инструкций программы в виде графа</em></p><blockquote><p>Порядок выполнения инструкций отражает структуру алгоритма, реализуемого программой.</p></blockquote><p>Каждой базовой алгоритмической конструкции соответствует свой порядок выполнения, как правило, с таким же названием.</p><p>Простейшим порядком выполнения является <em>последовательный</em> или <em>естественный порядок</em>, когда инструкции выполняются последовательно, одна за другой, в порядке их появления в записи программы. <em>Естественный порядок</em> образуется при реализации алгоритмической конструкции «следование».</p><p>Отклонение от естественного для применяемого способа записи порядка называется <em>переход</em>. В этом случае после окончания выполнения текущей инструкции вычислитель переходит не к следующей в записи, а к некоторой другой, определённым образом заданной инструкции. При <em>безусловном переходе</em> инструкция перехода выбирается без учета состояния вычислителя, при <em>условном переходе</em> — в зависимости от состояния вычислителя, путём проверки условия.</p><p><em>Условный переход</em> позволяет организовывать ветвление потока управления, образуя <em>ветвящийся порядок</em>, при котором исполнению подлежит только одна из двух или более внутренних фрагментов-ветвей программы. Ветвящийся порядок реализует алгоритмическую конструкцию «ветвление».</p><p>Переход к ранее выполненной инструкции позволяет организовать многократное исполнение набора инструкций, образуя <em>циклический порядок</em> их выполнения (цикл) и реализуя алгоритмическую конструкцию «цикл».</p><p>Другой способ организовать повторное выполнение набора инструкций в программе состоит в выделении предназначенных к повтору инструкций в обособленную часть программы, называемую <em>подпрограмма</em>, с возможностью многократной передачи управления (называемой вызов) в подпрограмму и последующим возвратом в место вызова.</p><p>Вычислитель может иметь возможность прервать выполнение программы и передать управление определённой инструкции в зависимости от своего состояния или сигналов внешних устройств, образуя <em>прерывание</em>. После его обработки выполнение программы может быть продолжено с места прерывания.</p><blockquote><p><strong>Прерывание</strong> (англ. interrupt) — сигнал от программного или аппаратного обеспечения, сообщающий процессору о наступлении какого-либо события, требующего немедленного внимания. Прерывание извещает процессор о наступлении высокоприоритетного события, требующего прерывания текущего кода, выполняемого процессором.</p></blockquote><p>Прерывание — одна из базовых концепций вычислительной техники, которая заключается в том, что при наступлении какого-либо события происходит передача управления специальной процедуре, называемой обработчиком прерываний. В отличие от условных и безусловных переходов, прерывание может быть вызвано в любом месте программы, в том числе если выполнение программы приостановлено, и обусловлено обычно внешними по отношению к программе событиями.</p><p>Передача управления заранее подготовленному набору инструкций для определённой, как правило необычной или ошибочной (исключительной), ситуации без возможности возврата в место возникновения образует <em>обработку исключений</em>.</p><blockquote><p><strong>Обработка исключительных ситуаций</strong> (англ. exception handling) — механизм языков программирования, предназначенный для описания реакции программы на ошибки времени выполнения и другие возможные проблемы (исключения), которые могут возникнуть при выполнении программы и приводят к невозможности (бессмысленности) дальнейшей отработки программой её базового алгоритма. В русском языке также применяется более короткая форма термина: «обработка исключений».</p></blockquote><p>Во время выполнения программы могут возникать ситуации, когда состояние внешних данных, устройств ввода-вывода или компьютерной системы в целом делает дальнейшие вычисления в соответствии с базовым алгоритмом невозможными или бессмысленными.</p><p>Классические примеры подобных ситуаций приведены ниже.</p><ul><li>Целочисленное деление на ноль. Конечного результата у данной операции быть не может, поэтому ни дальнейшие вычисления, ни попытка использования результата деления не приведут к решению задачи.</li><li>Ошибка при попытке считать данные с внешнего устройства. Если данные не удаётся получить, любые дальнейшие запланированные операции с ними бессмысленны.</li><li>Исчерпание доступной памяти. Если в какой-то момент система оказывается не в состоянии выделить достаточный для прикладной программы объём оперативной памяти, программа не сможет работать нормально.</li><li>Появление сигнала аварийного отключения электропитания системы. Прикладную задачу, по всей видимости, решить не удастся, в лучшем случае (при наличии какого-то резерва питания) прикладная программа может позаботиться о сохранении данных.</li></ul><p>Обработка исключительных ситуаций самой программой заключается в том, что при возникновении исключительной ситуации управление передаётся некоторому заранее определённому обработчику — блоку кода, процедуре, функции, которые выполняют необходимые действия.</p><h2 id="виды-ошибок-в-программировании-и-способы-отладки" tabindex="-1"><a class="header-anchor" href="#виды-ошибок-в-программировании-и-способы-отладки"><span>Виды ошибок в программировании и способы отладки</span></a></h2><blockquote><p><strong>Программная ошибка</strong> (арго баг от англ. bug — «жук») — означает ошибку в программе или в системе, из-за которой программа выдает неожиданное поведение и, как следствие, результат.</p></blockquote><p>Большинство программных ошибок возникают из-за ошибок, допущенных разработчиками программы в её исходном коде, либо в её дизайне. Также некоторые ошибки возникают из-за некорректной работы инструментов разработчика, например из-за компилятора, вырабатывающего некорректный код.</p><p>Термин «программная ошибка» обычно употребляется для обозначения ошибок, проявляющих себя на стадии работы программы, в отличие, например, от <em>ошибок проектирования</em> или <em>синтаксических ошибок</em>. Отчет, содержащий информацию об ошибке также называют отчетом о проблеме (англ. bug report). Отчет о критической проблеме (англ. crash), вызывающей аварийное завершение программы, называют крэш-репортом (англ. crash report).</p><p>Программные ошибки локализуются и устраняются в процессе тестирования и отладки программы.</p><h3 id="значение-и-классификация-ошибок-программного-обеспечения" tabindex="-1"><a class="header-anchor" href="#значение-и-классификация-ошибок-программного-обеспечения"><span>Значение и классификация ошибок программного обеспечения</span></a></h3><p>Чаще всего вне зависимости от более точных классификаций, выделяют три основных типа ошибок программирования (в зависимости от этапа разработки ПО, на котором выявляется ошибка):</p><ul><li><strong>синтаксические ошибки</strong><br> В любом языке программирования каждое выражение строится по определенным правилам. Когда в программе встречаются выражения или условия, которые нарушает эти правила, то говорят о наличии синтаксической ошибки. Синтаксическая ошибка легко обнаруживается компиляторами или интерпретаторами языка и легко исправляется.</li><li><strong>ошибки выполнения (ошибки времени выполнения)</strong><br> Такие ошибки, как правило, возникают в процессе выполнения программы и называются исключительными ситуациями. Их причины отличаются от других типов ошибок. Если в программе происходит исключение, это свидетельствует о непредвиденном событии: например, программе передали некорректные данные или была предпринята попытка деления на ноль, что математически недопустимо. Исключение также может возникнуть, если операционная система требует немедленного завершения программы. Хотя такие ошибки выполнения легко выявить, устранение их причин может быть сложной задачей.</li><li><strong>семантические ошибки (структурные или смысловые)</strong><br> Например, применение операторов, которые не дают нужного эффекта (например, <code>(a-b)</code> вместо <code>(a+b)</code>), ошибка в структуре алгоритма, в логической взаимосвязи его частей, в применении алгоритма к тем данным, к которым он неприменим и т.д. Правила семантики не формализуемы. Поэтому поиск и устранение семантической ошибки и составляет основу отладки.</li></ul><p>По важности:</p><ul><li>Критические;</li><li>Серьёзные;</li><li>Незначительные;</li><li>Косметические.</li></ul><p>По времени появления:</p><ul><li>Постоянно, при каждом запуске;</li><li>Иногда («плавающий» тип);</li><li>Только на машине у клиента (зависит от локальных настроек у клиента).</li></ul><p>По месту и направлению:</p><ul><li>Ошибки пользовательского интерфейса;</li><li>Системы обработки ошибок;</li><li>Ошибки, связанные с граничными условиями (например, некорректная обработка пустой строки или максимального числового значения);</li><li>Ошибки вычислений;</li><li>Ошибки управления потоками;</li><li>Ошибки обработки или интерпретации данных;</li><li>Повышение нагрузки;</li><li>Ошибки контроля версии и идентификаторов;</li><li>Ошибки тестирования.</li></ul><p>В зависимости от характера ошибки, программы и среды исполнения, ошибка может проявляться сразу или наоборот — долгое время оставаться незамеченной (например <em>Проблема 2038 года</em> которую затрагивали на прошлой лекции).</p><p>Также ошибка может проявляться в виде уязвимости, делающей возможным несанкционированный доступ к системе или целевую атаку.</p><h3 id="работа-с-ошибками-в-javascript" tabindex="-1"><a class="header-anchor" href="#работа-с-ошибками-в-javascript"><span>Работа с ошибками в JavaScript</span></a></h3><p>Неважно, насколько мы хороши в программировании, иногда наши скрипты содержат ошибки. Они могут возникать из-за наших промахов, неожиданного ввода пользователя, неправильного ответа сервера и по тысяче других причин.</p><p>Обычно скрипт в случае ошибки «падает» (сразу же останавливается), с выводом ошибки в консоль.</p><p>Но есть синтаксическая конструкция <code>try..catch</code>, которая позволяет «ловить» ошибки и вместо падения делать что-то более осмысленное.</p><p>Конструкция <code>try..catch</code> состоит из двух основных блоков: <code>try</code>, и затем <code>catch</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// код...</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// обработка ошибки</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Работает она так:</p><ol><li>Сначала выполняется код внутри блока <code>try {...}</code>.</li><li>Если в нём нет ошибок, то блок <code>catch(err)</code> игнорируется: выполнение доходит до конца <code>try</code> и потом далее, полностью пропуская <code>catch</code>.</li><li>Если же в нём возникает ошибка, то выполнение <code>try</code> прерывается, и поток управления переходит в начало <code>catch(err)</code>. Переменная <code>err</code> (можно использовать любое имя) содержит объект ошибки с подробной информацией о произошедшем.</li></ol><p>Таким образом, при ошибке в блоке <code>try {...}</code> скрипт не «падает», и мы получаем возможность обработать ошибку внутри <code>catch</code>.</p><p>Давайте рассмотрим примеры.</p><ul><li>Пример без ошибок: выведет <code>alert</code> (1) и (2):</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Начало блока try&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (1) &lt;--</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// ...код без ошибок</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Конец блока try&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// (2) &lt;--</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Catch игнорируется, так как нет ошибок&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (3)</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Пример с ошибками: выведет (1) и (3):</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Начало блока try&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (1) &lt;--</span></span>
<span class="line"></span>
<span class="line">  lalala<span class="token punctuation">;</span> <span class="token comment">// ошибка, переменная не определена!</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Конец блока try (никогда не выполнится)&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (2)</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Возникла ошибка!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (3) &lt;--</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>[!WARNING]<br><code>try..catch</code> работает только для ошибок, возникающих во время выполнения кода</p></blockquote><p>Чтобы <code>try..catch</code> работал, код должен быть выполнимым. Другими словами, это должен быть корректный JavaScript-код. Он не сработает, если код синтаксически неверен, например, содержит несовпадающее количество фигурных скобок:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Движок не может понять этот код, он некорректен&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JavaScript-движок сначала читает код, а затем исполняет его. Ошибки, которые возникают во время фазы чтения, называются ошибками парсинга. Их нельзя обработать (изнутри этого кода), потому что движок не понимает код.</p><p>Таким образом, <code>try..catch</code> может обрабатывать только ошибки, которые возникают в корректном коде. Такие ошибки называют «ошибками во время выполнения», а иногда «исключениями».</p><p>Когда возникает ошибка, JavaScript генерирует объект, содержащий её детали. Затем этот объект передаётся как аргумент в блок <code>catch</code>. Для всех встроенных ошибок этот объект имеет два основных свойства <code>name</code> и <code>message</code> и одно дополнительное <code>stack</code> (зависит от окружения в котором запускается код):</p><ul><li><p><code>name</code></p><p>Имя ошибки. Например, для неопределённой переменной это <code>&quot;ReferenceError&quot;</code>.</p></li><li><p><code>message</code></p><p>Текстовое сообщение о деталях ошибки.</p></li><li><p><code>stack</code></p><p>Текущий стек вызова: строка, содержащая информацию о последовательности вложенных вызовов, которые привели к ошибке. Используется в целях отладки.</p></li></ul><p>Например:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  lalala<span class="token punctuation">;</span> <span class="token comment">// ошибка, переменная не определена!</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lalala is not defined</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: lalala is not defined at (...стек вызовов)</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Можем также просто вывести ошибку целиком</span></span>
<span class="line">  <span class="token comment">// Ошибка приводится к строке вида &quot;name: message&quot;</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: lalala is not defined</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="примеры-использования" tabindex="-1"><a class="header-anchor" href="#примеры-использования"><span>Примеры использования</span></a></h3><p>Давайте рассмотрим реальные случаи использования <code>try..catch</code>.</p><p>JavaScript поддерживает метод <code>JSON.parse(str)</code> для чтения данных в особом формате <code>JSON</code>, который обычно используется для декодирования данных, полученных по сети, от сервера или из другого источника. Формат <code>JSON</code> в рамках данного курса подробно разбирать мы не будем, однако стоит сказать что он очень похож на то как в JavaScript задаются объекты данных.</p><p>Мы получаем их и вызываем <code>JSON.parse</code> вот так:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token string">&#39;{&quot;name&quot;:&quot;John&quot;, &quot;age&quot;: 30}&#39;</span><span class="token punctuation">;</span> <span class="token comment">// данные с сервера</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// преобразовали текстовое представление в JS-объект</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// теперь user - объект со свойствами из строки</span></span>
<span class="line"><span class="token function">alert</span><span class="token punctuation">(</span> user<span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span></span>
<span class="line"><span class="token function">alert</span><span class="token punctuation">(</span> user<span class="token punctuation">.</span>age <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>[!TIP]<br> Вы можете найти более детальную информацию о <code>JSON</code> по ссылке: <a href="https://learn.javascript.ru/json" target="_blank" rel="noopener noreferrer">Формат JSON, метод toJSON</a>.</p></blockquote><p>Если <code>json</code> некорректен, <code>JSON.parse</code> генерирует ошибку, то есть скрипт «падает».</p><p><em>Устроит ли нас такое поведение? Конечно нет!</em></p><p>Получается, что если вдруг что-то не так с данными, то посетитель никогда (если, конечно, не откроет консоль) об этом не узнает. А люди очень не любят, когда что-то «просто падает» без всякого сообщения об ошибке.</p><p>Давайте используем <code>try..catch</code> для обработки ошибки:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token string">&quot;{ некорректный JSON }&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- тут возникает ошибка...</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> user<span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// не сработает</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ...выполнение прыгает сюда</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;Извините, в данных ошибка, мы попробуем получить их ещё раз.&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> e<span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> e<span class="token punctuation">.</span>message <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Здесь мы используем блок <code>catch</code> только для вывода сообщения, но мы также можем сделать гораздо больше: отправить новый сетевой запрос, предложить посетителю альтернативный способ, отослать информацию об ошибке на сервер для логирования, всё лучше, чем просто «падение».</p><h3 id="генерация-собственных-ошибок" tabindex="-1"><a class="header-anchor" href="#генерация-собственных-ошибок"><span>Генерация собственных ошибок</span></a></h3><p>Что если <code>json</code> синтаксически корректен, но не содержит необходимого свойства <code>name</code>?</p><p>Например, так:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token string">&#39;{ &quot;age&quot;: 30 }&#39;</span><span class="token punctuation">;</span> <span class="token comment">// данные неполны</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- выполнится без ошибок</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> user<span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// нет свойства name!</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;не выполнится&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Здесь <code>JSON.parse</code> выполнится без ошибок, но на самом деле отсутствие свойства name для нас ошибка.</p><p>Для того, чтобы унифицировать обработку ошибок, мы воспользуемся оператором <code>throw</code>.</p><h4 id="оператор-«throw»" tabindex="-1"><a class="header-anchor" href="#оператор-«throw»"><span>Оператор «throw»</span></a></h4><p>Оператор <code>throw</code> генерирует ошибку.</p><p>Синтаксис:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">throw</span> <span class="token operator">&lt;</span>объект ошибки<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Технически в качестве объекта ошибки можно передать что угодно. Это может быть даже примитив, число или строка, но всё же лучше, чтобы это был объект, желательно со свойствами <code>name</code> и <code>message</code> (для совместимости со встроенными ошибками).</p><p>В JavaScript есть множество встроенных конструкторов для стандартных ошибок: <code>Error</code>, <code>SyntaxError</code>, <code>ReferenceError</code>, <code>TypeError</code> и другие. Можно использовать и их для создания объектов ошибки.</p><p>Их синтаксис:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// или</span></span>
<span class="line"><span class="token keyword">let</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyntaxError</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceError</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// ...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Для встроенных ошибок (не для любых объектов, только для ошибок), свойство <code>name</code> — это в точности имя конструктора. А свойство <code>message</code> берётся из аргумента.</p><p>Например:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot; Ого, ошибка! o_O&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error</span></span>
<span class="line"><span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  Ого, ошибка! o_O</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Давайте посмотрим, какую ошибку генерирует <code>JSON.parse</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;{ bad json o_O }&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SyntaxError</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Unexpected token b in JSON at position 2</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Как мы видим, это <code>SyntaxError</code>.</p><p>В нашем случае отсутствие свойства <code>name</code> — это ошибка, ведь пользователи должны иметь имена.</p><p>Сгенерируем её:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token string">&#39;{ &quot;age&quot;: 30 }&#39;</span><span class="token punctuation">;</span> <span class="token comment">// данные неполны</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- выполнится без ошибок</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SyntaxError</span><span class="token punctuation">(</span><span class="token string">&quot;Данные неполны: нет имени&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (1)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> user<span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;JSON Error: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// JSON Error: Данные неполны: нет имени</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>В строке (1) оператор <code>throw</code> генерирует ошибку <code>SyntaxError</code> с сообщением <code>message</code>. Точно такого же вида, как генерирует сам JavaScript. Выполнение блока <code>try</code> немедленно останавливается, и поток управления прыгает в <code>catch</code>.</p><p>Теперь блок <code>catch</code> становится единственным местом для обработки всех ошибок и для <code>JSON.parse</code> и для других случаев.</p><h3 id="проброс-исключения" tabindex="-1"><a class="header-anchor" href="#проброс-исключения"><span>Проброс исключения</span></a></h3><p>В примере выше мы использовали <code>try..catch</code> для обработки некорректных данных. А что, если в блоке <code>try {...}</code> возникнет другая неожиданная ошибка? Например, программная (неопределённая переменная) или какая-то ещё, а не ошибка, связанная с некорректными данными.</p><p>Пример:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token string">&#39;{ &quot;age&quot;: 30 }&#39;</span><span class="token punctuation">;</span> <span class="token comment">// данные неполны</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- забыл добавить &quot;let&quot; перед user</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;JSON Error: &quot;</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// JSON Error: ReferenceError: user is not defined</span></span>
<span class="line">  <span class="token comment">// (не JSON ошибка на самом деле)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Конечно, возможно все! Программисты совершают ошибки. Даже в утилитах с открытым исходным кодом, используемых миллионами людей на протяжении десятилетий — вдруг может быть обнаружена ошибка, которая приводит к ужасным взломам.</p><p>В нашем случае <code>try..catch</code> предназначен для выявления ошибок, связанных с некорректными данными. Но по своей природе <code>catch</code> получает все свои ошибки из <code>try</code>. Здесь он получает неожиданную ошибку, но всё также показывает то же самое сообщение <code>&quot;JSON Error&quot;</code>. Это неправильно и затрудняет отладку кода.</p><p>К счастью, мы можем выяснить, какую ошибку мы получили, например, по её свойству <code>name</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  user<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;ReferenceError&quot; из-за неопределённой переменной</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Есть простое правило:</p><blockquote><p>Блок <code>catch</code> должен обрабатывать только те ошибки, которые ему известны, и «пробрасывать» все остальные.</p></blockquote><p>Техника «проброс исключения» выглядит так:</p><ol><li>Блок <code>catch</code> получает все ошибки.</li><li>В блоке <code>catch(err) {...}</code> мы анализируем объект ошибки <code>err</code>.</li><li>Если мы не знаем как её обработать, тогда делаем <code>throw err</code>.</li></ol><p>В коде ниже мы используем проброс исключения, <code>catch</code> обрабатывает только <code>SyntaxError</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token string">&#39;{ &quot;age&quot;: 30 }&#39;</span><span class="token punctuation">;</span> <span class="token comment">// данные неполны</span></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SyntaxError</span><span class="token punctuation">(</span><span class="token string">&quot;Данные неполны: нет имени&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">blabla</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// неожиданная ошибка</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> user<span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;SyntaxError&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;JSON Error: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> e<span class="token punctuation">;</span> <span class="token comment">// проброс (1)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ошибка в строке (1) из блока <code>catch</code> «выпадает наружу» и может быть поймана другой внешней конструкцией <code>try..catch</code> (если есть), или «убьёт» скрипт.</p><p>Таким образом, блок <code>catch</code> фактически обрабатывает только те ошибки, с которыми он знает, как справляться, и пропускает остальные.</p><p>Пример ниже демонстрирует, как такие ошибки могут быть пойманы с помощью ещё одного уровня <code>try..catch</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">readData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token string">&#39;{ &quot;age&quot;: 30 }&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">    <span class="token function">blabla</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ошибка!</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>name <span class="token operator">!=</span> <span class="token string">&#39;SyntaxError&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> e<span class="token punctuation">;</span> <span class="token comment">// проброс исключения (не знаю как это обработать)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">readData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;Внешний catch поймал: &quot;</span> <span class="token operator">+</span> e <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// поймал!</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Здесь <code>readData</code> знает только, как обработать <code>SyntaxError</code>, тогда как внешний блок <code>try..catch</code> знает, как обработать всё.</p><h3 id="try-catch-finally" tabindex="-1"><a class="header-anchor" href="#try-catch-finally"><span><code>try..catch..finally</code></span></a></h3><p>Подождите, это ещё не всё.</p><p>Конструкция <code>try..catch</code> может содержать ещё одну секцию: <code>finally</code>.</p><p>Если секция есть, то она выполняется в любом случае:</p><ol><li>после <code>try</code>, если не было ошибок,</li><li>после <code>catch</code>, если ошибки были.</li></ol><p>Расширенный синтаксис выглядит следующим образом:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token operator">...</span> пробуем выполнить код<span class="token operator">...</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token operator">...</span> обрабатываем ошибки <span class="token operator">...</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token operator">...</span> выполняем всегда <span class="token operator">...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Попробуйте запустить такой код:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&#39;try&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">&#39;Сгенерировать ошибку?&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token constant">BAD_CODE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&#39;catch&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&#39;finally&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>У кода есть два пути выполнения:</p><ol><li>Если вы ответите на вопрос «Сгенерировать ошибку?» утвердительно, то <code>try</code> -&gt; <code>catch</code> -&gt; <code>finally</code>.</li><li>Если ответите отрицательно, то <code>try</code> -&gt; <code>finally</code>.</li></ol><p>Секцию <code>finally</code> часто используют, когда мы начали что-то делать и хотим завершить это вне зависимости от того, будет ошибка или нет.</p><p>Например, мы хотим измерить время, которое занимает функция чисел Фибоначчи <code>fib(n)</code>. Естественно, мы можем начать измерения до того, как функция начнёт выполняться и закончить после. Но что делать, если при вызове функции возникла ошибка? В частности, реализация <code>fib(n)</code> в коде ниже возвращает ошибку для отрицательных и для нецелых чисел.</p><p>Секция <code>finally</code> отлично подходит для завершения измерений несмотря ни на что.</p><p>Здесь <code>finally</code> гарантирует, что время будет измерено корректно в обеих ситуациях — и в случае успешного завершения <code>fib</code> и в случае ошибки:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token operator">+</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">&quot;Введите положительное целое число?&quot;</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> diff<span class="token punctuation">,</span> result<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> Math<span class="token punctuation">.</span><span class="token function">trunc</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">!=</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Должно быть целое неотрицательное число&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> n <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token operator">?</span> n <span class="token operator">:</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  result <span class="token operator">=</span> <span class="token function">fib</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">  diff <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">alert</span><span class="token punctuation">(</span>result <span class="token operator">||</span> <span class="token string">&quot;возникла ошибка&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Выполнение заняло </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>diff<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms</span><span class="token template-punctuation string">\`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Вы можете это проверить, запустив этот код и введя <code>35</code> в <code>prompt</code> — код завершится нормально, <code>finally</code> выполнится после <code>try</code>. А затем введите <code>-1</code> — незамедлительно произойдёт ошибка, выполнение займёт <code>0ms</code>. Оба измерения выполняются корректно.</p><p>Другими словами, неважно как завершилась функция: через <code>return</code> или <code>throw</code>. Секция <code>finally</code> срабатывает в обоих случаях.</p><blockquote><p>[!INFO]<br><strong>Переменные внутри <code>try..catch..finally</code> локальны</strong></p><p>Обратите внимание, что переменные <code>result</code> и <code>diff</code> в коде выше объявлены до <code>try..catch</code>. Если переменную объявить в блоке, например, в <code>try</code>, то она не будет доступна после него.</p></blockquote><h2 id="что-почитать-по-теме" tabindex="-1"><a class="header-anchor" href="#что-почитать-по-теме"><span>Что почитать по теме</span></a></h2><ul><li><a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D1%80%D1%8F%D0%B4%D0%BE%D0%BA_%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F" target="_blank" rel="noopener noreferrer">Статья на Википедии - Порядок выполнения</a></li><li><a href="https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%B5%D1%80%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5" target="_blank" rel="noopener noreferrer">Статья на Википедии - Прерывание</a></li><li><a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D1%82%D0%BE%D0%BA_%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F" target="_blank" rel="noopener noreferrer">Статья на Википедии - Поток выполнения</a></li><li><a href="https://ru.wikipedia.org/wiki/%D0%98%D0%BC%D0%BF%D0%B5%D1%80%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5" target="_blank" rel="noopener noreferrer">Статья на Википедии - Императивное программирование</a></li><li><a href="https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0_%D0%B8%D1%81%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B9" target="_blank" rel="noopener noreferrer">Статья на Википедии - Обработка исключений</a></li><li><a href="https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D0%B0%D1%8F_%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0" target="_blank" rel="noopener noreferrer">Статья на Википедии - Программная ошибка</a></li><li><a href="https://learn.javascript.ru/error-handling" target="_blank" rel="noopener noreferrer">Современный учебник JavaScript - Обработка ошибок</a></li><li><a href="https://www.w3schools.com/js/js_errors.asp" target="_blank" rel="noopener noreferrer">W3Schools - JavaScript Errors</a></li></ul>`,144))])}const v=e(r,[["render",d]]),b=JSON.parse('{"path":"/disciplines/op04/op04_14.html","title":"ОП.04 - 14 - Порядок выполнения и прерывания. Виды ошибок в программировании и способы отладки","lang":"ru-RU","frontmatter":{"description":"Примечание ЭТО АРХИВНАЯ ВЕРСИЯ КУРСА! Материалы предназначаются для пересдающих дисциплину \\"ОП.04 - Основы алгоритмизации и программирования\\" в соответствии с учебными планами С...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ОП.04 - 14 - Порядок выполнения и прерывания. Виды ошибок в программировании и способы отладки\\",\\"image\\":[\\"https://upload.wikimedia.org/wikipedia/commons/4/48/Control-flow-sample.svg\\"],\\"dateModified\\":\\"2025-10-31T12:29:12.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://it.vshp.online/disciplines/op04/op04_14.html"}],["meta",{"property":"og:site_name","content":"Кафедра ИТ"}],["meta",{"property":"og:title","content":"ОП.04 - 14 - Порядок выполнения и прерывания. Виды ошибок в программировании и способы отладки"}],["meta",{"property":"og:description","content":"Примечание ЭТО АРХИВНАЯ ВЕРСИЯ КУРСА! Материалы предназначаются для пересдающих дисциплину \\"ОП.04 - Основы алгоритмизации и программирования\\" в соответствии с учебными планами С..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://upload.wikimedia.org/wikipedia/commons/4/48/Control-flow-sample.svg"}],["meta",{"property":"og:locale","content":"ru-RU"}],["meta",{"property":"og:updated_time","content":"2025-10-31T12:29:12.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-31T12:29:12.000Z"}]]},"git":{"updatedTime":1761913752000,"contributors":[{"name":"PAVEL TKACHEV","username":"","email":"phoenixweiss@ya.ru","commits":1}],"changelog":[{"hash":"a771585bc5911f4a729d06794a6706536be6cc56","time":1761913752000,"email":"phoenixweiss@ya.ru","author":"PAVEL TKACHEV","message":"Update <a href=\\"http://index.md\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">index.md</a>, abacus.png, ada_lawlace.png, and 105 more files"}]},"autoDesc":true,"filePathRelative":"disciplines/op04/op04_14.md"}');export{v as comp,b as data};

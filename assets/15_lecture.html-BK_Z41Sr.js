import{_ as u,c as k,b as s,d as p,a as g,w as e,r,o as m,e as n}from"./app-CRAEKUA-.js";const y={};function b(v,a){const d=r("Mermaid"),i=r("Tabs");return m(),k("div",null,[a[8]||(a[8]=s("h1",{id:"мдк-11-01-15-расширенные-транзакции",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#мдк-11-01-15-расширенные-транзакции"},[s("span",null,"МДК.11.01 - 15 - Расширенные транзакции")])],-1)),a[9]||(a[9]=s("p",null,"Примеры данной темы используют учебную БД:",-1)),p(i,{data:[{id:"Структура БД"},{id:"Дамп"},{id:"Таблицы"}]},{title0:e(({value:t,isActive:l})=>[...a[0]||(a[0]=[n("Структура БД",-1)])]),title1:e(({value:t,isActive:l})=>[...a[1]||(a[1]=[n("Дамп",-1)])]),title2:e(({value:t,isActive:l})=>[...a[2]||(a[2]=[n("Таблицы",-1)])]),tab0:e(({value:t,isActive:l})=>[p(d,{code:"eJxLLXLJTEwvSszlUlAoLU4tKlaoBrIUFDz9QhQyUxQCvMG8MMcgZw/HIIW8xNxUoEAtECcmJ+eX5pXgV1+SWZID0gCRB5kfD1TkBlHk4urs6evoo5CUmJOYlwwzF+KImhpd3fxqhCVWCkoX9l3YcmHHhb26F3Zd2Kd7Yc+FvUCRzUCRPUpcAN0zQl0="})]),tab1:e(({value:t,isActive:l})=>[...a[3]||(a[3]=[s("div",{class:"language-sql line-numbers-mode has-collapsed-lines collapsed","data-highlighter":"prismjs","data-ext":"sql",style:{"--vp-collapsed-lines":"10"}},[s("pre",null,[s("code",{class:"language-sql"},[s("span",{class:"line"},[s("span",{class:"token keyword"},"SET"),n(" foreign_key_checks "),s("span",{class:"token operator"},"="),n(),s("span",{class:"token number"},"0"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"}),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"DROP"),n(),s("span",{class:"token keyword"},"TABLE"),n(),s("span",{class:"token keyword"},"IF"),n(),s("span",{class:"token keyword"},"EXISTS"),n(" users"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"DROP"),n(),s("span",{class:"token keyword"},"TABLE"),n(),s("span",{class:"token keyword"},"IF"),n(),s("span",{class:"token keyword"},"EXISTS"),n(" accounts"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"}),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"CREATE"),n(),s("span",{class:"token keyword"},"TABLE"),n(),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("users"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token punctuation"},"(")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("id"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token keyword"},"INT"),n(),s("span",{class:"token operator"},"NOT"),n(),s("span",{class:"token boolean"},"NULL"),n(),s("span",{class:"token keyword"},"AUTO_INCREMENT"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("name"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token keyword"},"VARCHAR"),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"255"),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token operator"},"NOT"),n(),s("span",{class:"token boolean"},"NULL"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token keyword"},"PRIMARY"),n(),s("span",{class:"token keyword"},"KEY"),n(),s("span",{class:"token punctuation"},"("),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("id"),s("span",{class:"token punctuation"},"`")]),s("span",{class:"token punctuation"},")")]),n(`
`),s("span",{class:"line"},[s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"}),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"LOCK"),n(),s("span",{class:"token keyword"},"TABLES"),n(),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("users"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token keyword"},"WRITE"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"INSERT"),n(),s("span",{class:"token keyword"},"INTO"),n(),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("users"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token keyword"},"VALUES"),n(),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},","),s("span",{class:"token string"},"'Иванов Иван Иванович'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},","),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"2"),s("span",{class:"token punctuation"},","),s("span",{class:"token string"},"'Петров Петр Петрович'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},","),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"3"),s("span",{class:"token punctuation"},","),s("span",{class:"token string"},"'Сидоров Сидор Сидорович'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"UNLOCK"),n(),s("span",{class:"token keyword"},"TABLES"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"}),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"CREATE"),n(),s("span",{class:"token keyword"},"TABLE"),n(),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("accounts"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token punctuation"},"(")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("id"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token keyword"},"INT"),n(),s("span",{class:"token operator"},"NOT"),n(),s("span",{class:"token boolean"},"NULL"),n(),s("span",{class:"token keyword"},"AUTO_INCREMENT"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("title"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token keyword"},"VARCHAR"),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"255"),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token keyword"},"DEFAULT"),n(),s("span",{class:"token boolean"},"NULL"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("user_id"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token keyword"},"INT"),n(),s("span",{class:"token operator"},"NOT"),n(),s("span",{class:"token boolean"},"NULL"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("balance"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token keyword"},"DECIMAL"),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"10"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"2"),s("span",{class:"token punctuation"},")"),n(),s("span",{class:"token operator"},"NOT"),n(),s("span",{class:"token boolean"},"NULL"),n(),s("span",{class:"token keyword"},"DEFAULT"),n(),s("span",{class:"token string"},"'0.00'"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token keyword"},"PRIMARY"),n(),s("span",{class:"token keyword"},"KEY"),n(),s("span",{class:"token punctuation"},"("),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("id"),s("span",{class:"token punctuation"},"`")]),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token keyword"},"KEY"),n(),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("user_id_idx"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token punctuation"},"("),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("user_id"),s("span",{class:"token punctuation"},"`")]),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},",")]),n(`
`),s("span",{class:"line"},[n("  "),s("span",{class:"token keyword"},"CONSTRAINT"),n(),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("user_id"),s("span",{class:"token punctuation"},"`")])]),n(`
`),s("span",{class:"line"},[n("    "),s("span",{class:"token keyword"},"FOREIGN"),n(),s("span",{class:"token keyword"},"KEY"),n(),s("span",{class:"token punctuation"},"("),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("user_id"),s("span",{class:"token punctuation"},"`")]),s("span",{class:"token punctuation"},")")]),n(`
`),s("span",{class:"line"},[n("    "),s("span",{class:"token keyword"},"REFERENCES"),n(),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("users"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token punctuation"},"("),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("id"),s("span",{class:"token punctuation"},"`")]),s("span",{class:"token punctuation"},")")]),n(`
`),s("span",{class:"line"},[n("    "),s("span",{class:"token keyword"},"ON"),n(),s("span",{class:"token keyword"},"DELETE"),n(),s("span",{class:"token keyword"},"CASCADE")]),n(`
`),s("span",{class:"line"},[n("    "),s("span",{class:"token keyword"},"ON"),n(),s("span",{class:"token keyword"},"UPDATE"),n(),s("span",{class:"token keyword"},"CASCADE")]),n(`
`),s("span",{class:"line"},[s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"}),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"LOCK"),n(),s("span",{class:"token keyword"},"TABLES"),n(),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("accounts"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token keyword"},"WRITE"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"INSERT"),n(),s("span",{class:"token keyword"},"INTO"),n(),s("span",{class:"token identifier"},[s("span",{class:"token punctuation"},"`"),n("accounts"),s("span",{class:"token punctuation"},"`")]),n(),s("span",{class:"token keyword"},"VALUES"),n(),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},","),s("span",{class:"token string"},"'Основной'"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"10500.00"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},","),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"2"),s("span",{class:"token punctuation"},","),s("span",{class:"token string"},"'Резервный'"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"3412.57"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},","),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"3"),s("span",{class:"token punctuation"},","),s("span",{class:"token string"},"'Основной'"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"2"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"20750.00"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},","),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"4"),s("span",{class:"token punctuation"},","),s("span",{class:"token string"},"'Основной'"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"3"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"25000.00"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},","),s("span",{class:"token punctuation"},"("),s("span",{class:"token number"},"5"),s("span",{class:"token punctuation"},","),s("span",{class:"token string"},"'Накопительный'"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"2"),s("span",{class:"token punctuation"},","),s("span",{class:"token number"},"5401.75"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"UNLOCK"),n(),s("span",{class:"token keyword"},"TABLES"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"}),n(`
`),s("span",{class:"line"},[s("span",{class:"token keyword"},"SET"),n(" foreign_key_checks "),s("span",{class:"token operator"},"="),n(),s("span",{class:"token number"},"1"),s("span",{class:"token punctuation"},";")]),n(`
`),s("span",{class:"line"})])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})]),s("div",{class:"collapsed-lines"})],-1)])]),tab2:e(({value:t,isActive:l})=>[p(i,{data:[{id:"<strong>users</strong>"},{id:"<strong>accounts</strong>"}]},{title0:e(({value:o,isActive:c})=>[...a[4]||(a[4]=[s("strong",null,"users",-1)])]),title1:e(({value:o,isActive:c})=>[...a[5]||(a[5]=[s("strong",null,"accounts",-1)])]),tab0:e(({value:o,isActive:c})=>[...a[6]||(a[6]=[s("table",null,[s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"right"}},"id"),s("th",{style:{"text-align":"left"}},"name")])]),s("tbody",null,[s("tr",null,[s("td",{style:{"text-align":"right"}},"1"),s("td",{style:{"text-align":"left"}},"Иванов Иван Иванович")]),s("tr",null,[s("td",{style:{"text-align":"right"}},"2"),s("td",{style:{"text-align":"left"}},"Петров Петр Петрович")]),s("tr",null,[s("td",{style:{"text-align":"right"}},"3"),s("td",{style:{"text-align":"left"}},"Сидоров Сидор Сидорович")])])],-1)])]),tab1:e(({value:o,isActive:c})=>[...a[7]||(a[7]=[s("table",null,[s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"right"}},"id"),s("th",{style:{"text-align":"left"}},"title"),s("th",{style:{"text-align":"right"}},"user_id"),s("th",{style:{"text-align":"right"}},"balance")])]),s("tbody",null,[s("tr",null,[s("td",{style:{"text-align":"right"}},"1"),s("td",{style:{"text-align":"left"}},"Основной"),s("td",{style:{"text-align":"right"}},"1"),s("td",{style:{"text-align":"right"}},"10500")]),s("tr",null,[s("td",{style:{"text-align":"right"}},"2"),s("td",{style:{"text-align":"left"}},"Резервный"),s("td",{style:{"text-align":"right"}},"1"),s("td",{style:{"text-align":"right"}},"3412.57")]),s("tr",null,[s("td",{style:{"text-align":"right"}},"3"),s("td",{style:{"text-align":"left"}},"Основной"),s("td",{style:{"text-align":"right"}},"2"),s("td",{style:{"text-align":"right"}},"20750")]),s("tr",null,[s("td",{style:{"text-align":"right"}},"4"),s("td",{style:{"text-align":"left"}},"Основной"),s("td",{style:{"text-align":"right"}},"3"),s("td",{style:{"text-align":"right"}},"25000")]),s("tr",null,[s("td",{style:{"text-align":"right"}},"5"),s("td",{style:{"text-align":"left"}},"Накопительный"),s("td",{style:{"text-align":"right"}},"2"),s("td",{style:{"text-align":"right"}},"5401.75")])])],-1)])]),_:2},1024)]),_:1}),a[10]||(a[10]=g(`<h2 id="уровни-изоляции-транзакции" tabindex="-1"><a class="header-anchor" href="#уровни-изоляции-транзакции"><span>Уровни изоляции транзакций</span></a></h2><p>В MySQL 8 существует четыре уровня изоляции транзакций: <code>READ UNCOMMITTED</code>, <code>READ COMMITTED</code>, <code>REPEATABLE READ</code> и <code>SERIALIZABLE</code>.</p><p>Все примеры ниже будут использовать код двух транзакций:</p><p>Транзакция 1:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> <span class="token number">1000</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Транзакция 2:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> <span class="token number">250</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">COMMIT</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Уровни изоляции позволяют настроить баланс между производительностью и надежностью транзакций в зависимости от требований приложения.</p><ol><li><code>READ UNCOMMITTED</code> (неподтвержденное чтение): Этот уровень позволяет одной транзакции читать неподтвержденные изменения, внесенные другой транзакцией.</li></ol><p>Чтобы задать соответствующий уровень, после начала транзакции, необходимо его установить командой:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">READ</span> <span class="token keyword">UNCOMMITTED</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Если транзакция 1 выполняется в режиме <code>READ UNCOMMITTED</code>, она сможет прочитать изменения, внесенные транзакцией 2, даже до ее подтверждения.</p><ol start="2"><li><code>READ COMMITTED</code> (подтвержденное чтение): Этот уровень позволяет транзакции читать только подтвержденные изменения других транзакций.</li></ol><p>Чтобы задать соответствующий уровень, после начала транзакции, необходимо его установить командой:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">READ</span> <span class="token keyword">COMMITTED</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Если транзакция 1 выполняется в режиме <code>READ COMMITTED</code>, она не сможет прочитать изменения, внесенные транзакцией 2, до ее подтверждения.</p><ol start="3"><li><code>REPEATABLE READ</code> (повторяемое чтение): Этот уровень гарантирует, что транзакция будет видеть одни и те же данные при повторном чтении в рамках одной транзакции.</li></ol><p>Чтобы задать соответствующий уровень, после начала транзакции, необходимо его установить командой:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">REPEATABLE</span> <span class="token keyword">READ</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Если транзакция 1 выполняется в режиме <code>REPEATABLE READ</code>, она будет видеть исходные данные при повторном чтении, даже после подтверждения изменений транзакцией 2.</p><ol start="4"><li><code>SERIALIZABLE</code> (сериализуемое чтение): Этот уровень гарантирует полную изоляцию транзакций, предотвращая конфликты и аномалии.</li></ol><p>Чтобы задать соответствующий уровень, после начала транзакции, необходимо его установить командой:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">SERIALIZABLE</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Если транзакция 1 выполняется в режиме <code>SERIALIZABLE</code>, она будет заблокирована до подтверждения изменений транзакцией 2, чтобы избежать возможных конфликтов.</p><hr><h3 id="возможные-аномалии-по-уровням" tabindex="-1"><a class="header-anchor" href="#возможные-аномалии-по-уровням"><span>Возможные аномалии по уровням</span></a></h3><table><thead><tr><th style="text-align:center;">Уровень изоляции</th><th style="text-align:center;">Потерянное обновление</th><th style="text-align:center;">«Грязное» чтение</th><th style="text-align:center;">Неповторяющееся чтение</th><th style="text-align:center;">Чтение «фантомов»</th></tr></thead><tbody><tr><td style="text-align:center;"><code>NONE</code></td><td style="text-align:center;">ДА</td><td style="text-align:center;">ДА</td><td style="text-align:center;">ДА</td><td style="text-align:center;">ДА</td></tr><tr><td style="text-align:center;"><code>READ UNCOMMITTED</code></td><td style="text-align:center;">НЕТ</td><td style="text-align:center;">ДА</td><td style="text-align:center;">ДА</td><td style="text-align:center;">ДА</td></tr><tr><td style="text-align:center;"><code>READ COMMITTED</code></td><td style="text-align:center;">НЕТ</td><td style="text-align:center;">НЕТ</td><td style="text-align:center;">ДА</td><td style="text-align:center;">ДА</td></tr><tr><td style="text-align:center;"><code>REPEATABLE READ</code></td><td style="text-align:center;">НЕТ</td><td style="text-align:center;">НЕТ</td><td style="text-align:center;">НЕТ</td><td style="text-align:center;">ДА</td></tr><tr><td style="text-align:center;"><code>SERIALIZABLE</code></td><td style="text-align:center;">НЕТ</td><td style="text-align:center;">НЕТ</td><td style="text-align:center;">НЕТ</td><td style="text-align:center;">НЕТ</td></tr></tbody></table><ul><li><p><strong>Потерянное обновление</strong> — Ситуация, когда при одновременном изменении одного блока данных разными транзакциями одно из изменений теряется.</p></li><li><p><strong>«Грязное» чтение</strong> — Чтение данных, добавленных или изменённых транзакцией, которая впоследствии не подтвердится (откатится).</p></li><li><p><strong>Неповторяющееся чтение</strong> — Ситуация, когда при повторном чтении в рамках одной транзакции ранее прочитанные данные оказываются изменёнными.</p></li><li><p><strong>Чтение «фантомов»</strong> — Ситуация, когда при повторном чтении в рамках одной транзакции одна и та же выборка дает разные множества строк.</p></li></ul><h3 id="уровень-изоляции-по-умолчанию" tabindex="-1"><a class="header-anchor" href="#уровень-изоляции-по-умолчанию"><span>Уровень изоляции по-умолчанию</span></a></h3><p>Чтобы узнать уровень изоляции транзакций, используемый по умолчанию в MySQL 8, можно выполнить следующий запрос:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> @<span class="token variable">@global.transaction_isolation</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Этот запрос вернет текущее значение переменной <code>transaction_isolation</code>, которая указывает на уровень изоляции транзакций, используемый по умолчанию. Возможные значения переменной <code>transaction_isolation</code> включают <code>READ UNCOMMITTED</code>, <code>READ COMMITTED</code>, <code>REPEATABLE READ</code>, <code>SERIALIZABLE</code> и <code>NONE</code>.</p><div class="hint-container warning"><p class="hint-container-title">Примечание</p><p>Обратите внимание, что доступ к этой информации может потребовать привилегий администратора базы данных.</p></div><h2 id="работа-с-точками-восстановления" tabindex="-1"><a class="header-anchor" href="#работа-с-точками-восстановления"><span>Работа с точками восстановления</span></a></h2><p>Точка восстановления, или <code>SAVEPOINT</code> — это зафиксированное состояние БД к которому можно откатиться в рамках команды <code>ROLLBACK</code>.</p><p>Допустим, пользователь <code>Иванов Иван Иванович</code> переводит деньги сразу нескольким пользователям в рамках одной &quot;сделки&quot;. Логично оформить набор запросов в виде единой транзакции, но при этом зафиксировать состояния внутри неё, чтобы иметь возможность откатиться на любой шаг.</p><ol><li>Начинаем транзакцию:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>Получаем текущий баланс Иванова и номер его основного счета:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> balance <span class="token keyword">FROM</span> accounts <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> title <span class="token operator">=</span> <span class="token string">&#39;Основной&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>Фиксируем состояния до того как начали перевод средств:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SAVEPOINT</span> SavePoint1<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="4"><li>Переводим <code>5000</code> рублей с основного счёта Иванова на основной счёт Петрова:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">5000</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> <span class="token number">5000</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>Фиксируем состояние в этой точке:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SAVEPOINT</span> SavePoint2<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="6"><li>Переводим <code>1500</code> рублей с основного счёта Иванова на основной счёт Сидорова:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">1500</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> <span class="token number">1500</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="7"><li>Фиксируем состояние в этой точке:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SAVEPOINT</span> SavePoint3<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="8"><li>Посмотрим сколько денег осталось на основном счёте Иванова:</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> balance <span class="token keyword">FROM</span> accounts <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> title <span class="token operator">=</span> <span class="token string">&#39;Основной&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>На данный момент у нас есть возможность произвести следующие действия:</p><ul><li>Если всё прошло хорошо, и результаты всех действий нас устроили, можем зафиксировать результаты при помощи <code>COMMIT;</code>.</li><li>Если нам нужно откатиться на состояние после того как мы перевели деньги Сидорову, можем выполнить <code>ROLLBACK TO SavePoint3;</code>.</li><li>Если нам нужно откатиться на состояние после того как мы перевели деньги Петрову, но до того как мы начали переводить деньги Сидорову, можем выполнить <code>ROLLBACK TO SavePoint2;</code>.</li><li>Если нам нужно откатиться на состояние до того как мы начали переводить деньги, можем выполнить <code>ROLLBACK TO SavePoint1;</code>.</li><li>Если нужно вернуть БД в состояние как будто целой транзакции не было, используем просто <code>ROLLBACK;</code>, при этом промежуточные состояния точек восстановления учтены не будут.</li><li>Если какая-либо из точек восстановления уже не нужна, очистить её из памяти можно при помощи команды <code>RELEASE SAVEPOINT SavePoint1;</code>.</li></ul><div class="hint-container warning"><p class="hint-container-title">Примечание</p><p>Важно, что откатывая состояние на более раннюю точку восстановления, мы также лишаем себя возможности восстановиться на более поздней. То есть, возвращаясь в более раннюю точку мы фактически возвращаемся в состояние в котором более поздних просто не существовало!</p></div><div class="hint-container info"><p class="hint-container-title">Инфо</p><p>Стоит учесть что в большинстве СУБД после закрытия транзакции, откатиться на точку восстановления уже не выйдет, поэтому для сохранения состояния БД между транзакциями используются уже другие механизмы.</p></div>`,56))])}const h=u(y,[["render",b]]),T=JSON.parse('{"path":"/disciplines/mdk1101/lectures/15_lecture.html","title":"МДК.11.01 - 15 - Расширенные транзакции","lang":"ru-RU","frontmatter":{"description":"МДК.11.01 - 15 - Расширенные транзакции Примеры данной темы используют учебную БД: Уровни изоляции транзакций В MySQL 8 существует четыре уровня изоляции транзакций: READ UNCOMM...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"МДК.11.01 - 15 - Расширенные транзакции\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-24T14:30:06.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://it.vshp.online/disciplines/mdk1101/lectures/15_lecture.html"}],["meta",{"property":"og:site_name","content":"Кафедра ИТ"}],["meta",{"property":"og:title","content":"МДК.11.01 - 15 - Расширенные транзакции"}],["meta",{"property":"og:description","content":"МДК.11.01 - 15 - Расширенные транзакции Примеры данной темы используют учебную БД: Уровни изоляции транзакций В MySQL 8 существует четыре уровня изоляции транзакций: READ UNCOMM..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ru-RU"}],["meta",{"property":"og:updated_time","content":"2025-10-24T14:30:06.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-24T14:30:06.000Z"}]]},"git":{"updatedTime":1761316206000,"contributors":[{"name":"PAVEL TKACHEV","username":"","email":"phoenixweiss@ya.ru","commits":1}],"changelog":[{"hash":"7164abf5ea181652ae6e18935015af58c1253ed4","time":1761316206000,"email":"phoenixweiss@ya.ru","author":"PAVEL TKACHEV","message":"Update 14_lecture.md, 15_lecture.md, 16_lecture.md, and 16 more files"}]},"autoDesc":true,"filePathRelative":"disciplines/mdk1101/lectures/15_lecture.md"}');export{h as comp,T as data};
